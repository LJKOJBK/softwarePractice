{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\View/assets\\Script\\View\\EffectLayer.js"],"names":["cc","Class","extends","Component","properties","bombWhite","default","type","Prefab","crushEffect","audioUtils","AudioUtils","onLoad","playEffects","effectQueue","length","soundMap","forEach","cmd","delayTime","playTime","callFunc","instantEffect","animation","action","instantiate","getComponent","Animation","play","playEliminate","step","x","CELL_WIDTH","pos","y","parent","node","on","destroy","runAction","sequence"],"mappings":";;;;;;AAAA;;AAEA;;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,mBAAU;AACNC,qBAAS,IADH;AAENC,kBAAMP,GAAGQ;AAFH,SAXF;AAeRC,qBAAY;AACRH,qBAAS,IADD;AAERC,kBAAMP,GAAGQ;AAFD,SAfJ;AAmBRE,oBAAW;AACPH,kBAAMI,oBADC;AAEPL,qBAAS;AAFF;AAnBH,KAHP;;AA4BL;AACAM,YAAQ,kBAAY,CAEnB,CA/BI;AAgCLC,iBAAa,qBAASC,WAAT,EAAqB;AAC9B,YAAG,CAACA,WAAD,IAAgBA,YAAYC,MAAZ,IAAsB,CAAzC,EAA2C;AACvC;AACH;AACD,YAAIC,WAAW,EAAf,CAJ8B,CAIX;AACnBF,oBAAYG,OAAZ,CAAoB,UAASC,GAAT,EAAa;AAC7B,gBAAIC,YAAYnB,GAAGmB,SAAH,CAAaD,IAAIE,QAAjB,CAAhB;AACA,gBAAIC,WAAWrB,GAAGqB,QAAH,CAAY,YAAU;AACjC,oBAAIC,gBAAgB,IAApB;AACA,oBAAIC,YAAY,IAAhB;AACA,oBAAGL,IAAIM,MAAJ,IAAc,OAAjB,EAAyB;AACrBF,oCAAgBtB,GAAGyB,WAAH,CAAe,KAAKhB,WAApB,CAAhB;AACAc,gCAAaD,cAAcI,YAAd,CAA2B1B,GAAG2B,SAA9B,CAAb;AACAJ,8BAAUK,IAAV,CAAe,QAAf;AACA,qBAACZ,SAAS,UAAUE,IAAIE,QAAvB,CAAD,IAAqC,KAAKV,UAAL,CAAgBmB,aAAhB,CAA8BX,IAAIY,IAAlC,CAArC;AACAd,6BAAS,UAAUE,IAAIE,QAAvB,IAAmC,IAAnC;AACH,iBAND,MAOK,IAAGF,IAAIM,MAAJ,IAAc,SAAjB,EAA2B;AAC5BF,oCAAgBtB,GAAGyB,WAAH,CAAe,KAAKpB,SAApB,CAAhB;AACAkB,gCAAaD,cAAcI,YAAd,CAA2B1B,GAAG2B,SAA9B,CAAb;AACAJ,8BAAUK,IAAV,CAAe,aAAf;AACH,iBAJI,MAKA,IAAGV,IAAIM,MAAJ,IAAc,SAAjB,EAA2B;AAC5BF,oCAAgBtB,GAAGyB,WAAH,CAAe,KAAKpB,SAApB,CAAhB;AACAkB,gCAAaD,cAAcI,YAAd,CAA2B1B,GAAG2B,SAA9B,CAAb;AACAJ,8BAAUK,IAAV,CAAe,YAAf;AACH;;AAEDN,8BAAcS,CAAd,GAAkBC,0BAAcd,IAAIe,GAAJ,CAAQF,CAAR,GAAY,GAA1B,CAAlB;AACAT,8BAAcY,CAAd,GAAkBF,0BAAcd,IAAIe,GAAJ,CAAQC,CAAR,GAAY,GAA1B,CAAlB;AACAZ,8BAAca,MAAd,GAAuB,KAAKC,IAA5B;AACAb,0BAAUc,EAAV,CAAa,UAAb,EAAwB,YAAU;AAC9Bf,kCAAcgB,OAAd;AACH,iBAFD,EAEE,IAFF;AAIH,aA5Bc,EA4Bb,IA5Ba,CAAf;AA6BA,iBAAKF,IAAL,CAAUG,SAAV,CAAoBvC,GAAGwC,QAAH,CAAYrB,SAAZ,EAAuBE,QAAvB,CAApB;AACH,SAhCD,EAgCE,IAhCF;AAiCH;;AAED;AACA;;AAEA;AA3EK,CAAT","file":"EffectLayer.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\View","sourcesContent":["import {CELL_WIDTH} from '../Model/ConstValue';\r\n\r\nimport AudioUtils from \"../Utils/AudioUtils\";\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        bombWhite:{\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        crushEffect:{\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        audioUtils:{\r\n            type: AudioUtils,\r\n            default: null\r\n        }\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n\r\n    },\r\n    playEffects: function(effectQueue){\r\n        if(!effectQueue || effectQueue.length <= 0){\r\n            return ;\r\n        }\r\n        let soundMap = {}; //某一时刻，某一种声音是否播放过的标记，防止重复播放\r\n        effectQueue.forEach(function(cmd){\r\n            let delayTime = cc.delayTime(cmd.playTime);\r\n            let callFunc = cc.callFunc(function(){\r\n                let instantEffect = null;\r\n                let animation = null;\r\n                if(cmd.action == \"crush\"){\r\n                    instantEffect = cc.instantiate(this.crushEffect);\r\n                    animation  = instantEffect.getComponent(cc.Animation);\r\n                    animation.play(\"effect\");\r\n                    !soundMap[\"crush\" + cmd.playTime] && this.audioUtils.playEliminate(cmd.step);\r\n                    soundMap[\"crush\" + cmd.playTime] = true;\r\n                }\r\n                else if(cmd.action == \"rowBomb\"){\r\n                    instantEffect = cc.instantiate(this.bombWhite);\r\n                    animation  = instantEffect.getComponent(cc.Animation);\r\n                    animation.play(\"effect_line\");\r\n                }\r\n                else if(cmd.action == \"colBomb\"){\r\n                    instantEffect = cc.instantiate(this.bombWhite);\r\n                    animation  = instantEffect.getComponent(cc.Animation);\r\n                    animation.play(\"effect_col\");\r\n                }\r\n\r\n                instantEffect.x = CELL_WIDTH * (cmd.pos.x - 0.5);\r\n                instantEffect.y = CELL_WIDTH * (cmd.pos.y - 0.5);\r\n                instantEffect.parent = this.node;\r\n                animation.on(\"finished\",function(){\r\n                    instantEffect.destroy();\r\n                },this);\r\n               \r\n            },this);\r\n            this.node.runAction(cc.sequence(delayTime, callFunc));\r\n        },this);\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}