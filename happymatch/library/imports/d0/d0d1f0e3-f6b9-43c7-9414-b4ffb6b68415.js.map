{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\View/assets\\Script\\View\\GridView.js"],"names":["cc","Class","extends","Component","properties","aniPre","default","type","Prefab","effectLayer","Node","audioUtils","AudioUtils","onLoad","setListener","lastTouchPos","Vec2","isCanMove","isInPlayAni","setController","controller","initWithCellModels","cellsModels","cellViews","i","j","aniView","instantiate","parent","node","cellViewScript","getComponent","initWithModel","on","EventType","TOUCH_START","eventTouch","touchPos","getLocation","cellPos","convertTouchPosToCell","changeModels","selectCell","length","TOUCH_MOVE","startTouchPos","getStartLocation","startCellPos","x","y","TOUCH_END","TOUCH_CANCEL","pos","convertToNodeSpace","GRID_PIXEL_WIDTH","GRID_PIXEL_HEIGHT","Math","floor","CELL_WIDTH","CELL_HEIGHT","v2","updateView","newCellViewInfo","model","viewInfo","findViewByModel","view","cellScript","isDeath","push","forEach","ele","updateSelect","setSelect","getPlayAniTime","maxTime","cmd","playTime","keepTime","getStep","effectsQueue","reduce","maxValue","efffectCmd","max","step","disableTouch","time","runAction","sequence","delayTime","callFunc","playContinuousMatch","result","playEffect","cleanCmd","playSwap","playClick","playEffects"],"mappings":"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","file":"GridView.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\View","sourcesContent":["import { CELL_WIDTH, CELL_HEIGHT, GRID_PIXEL_WIDTH, GRID_PIXEL_HEIGHT, ANITIME } from '../Model/ConstValue';\r\n\r\nimport AudioUtils from \"../Utils/AudioUtils\";\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n\r\n        // 记录所有预设动物元素\r\n        aniPre: {\r\n            default: [],\r\n            type: [cc.Prefab]\r\n        },\r\n        effectLayer: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        audioUtils: {\r\n            type: AudioUtils,\r\n            default: null\r\n        }\r\n\r\n    },\r\n\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this.setListener(); // 所有事件监听\r\n        this.lastTouchPos = cc.Vec2(-1, -1);\r\n        this.isCanMove = true;\r\n        this.isInPlayAni = false; // 是否在播放中\r\n    },\r\n    setController: function (controller) {\r\n        this.controller = controller;\r\n    },\r\n\r\n    initWithCellModels: function (cellsModels) {\r\n        this.cellViews = [];\r\n        for (var i = 1; i <= 9; i++) {\r\n            this.cellViews[i] = [];\r\n            for (var j = 1; j <= 9; j++) {\r\n                var type = cellsModels[i][j].type;\r\n                var aniView = cc.instantiate(this.aniPre[type]);\r\n                aniView.parent = this.node;\r\n                var cellViewScript = aniView.getComponent(\"CellView\");\r\n                cellViewScript.initWithModel(cellsModels[i][j]);\r\n                this.cellViews[i][j] = aniView;\r\n            }\r\n        }\r\n    },\r\n    setListener: function () {\r\n        // 添加点击事件\r\n        this.node.on(cc.Node.EventType.TOUCH_START, function (eventTouch) {\r\n            if (this.isInPlayAni) {//播放动画中，不允许点击\r\n                return true;\r\n            }\r\n            // 获取点击位置，通过点击位置推出点击元素\r\n            var touchPos = eventTouch.getLocation();\r\n            var cellPos = this.convertTouchPosToCell(touchPos);\r\n            if (cellPos) {\r\n                var changeModels = this.selectCell(cellPos);\r\n                this.isCanMove = changeModels.length < 3;\r\n            }\r\n            else {\r\n                this.isCanMove = false;\r\n            }\r\n            return true;\r\n        }, this);\r\n        // 滑动操作逻辑\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, function (eventTouch) {\r\n            if (this.isCanMove) {\r\n                var startTouchPos = eventTouch.getStartLocation();\r\n                var startCellPos = this.convertTouchPosToCell(startTouchPos);\r\n                var touchPos = eventTouch.getLocation();\r\n                var cellPos = this.convertTouchPosToCell(touchPos);\r\n                if (startCellPos.x != cellPos.x || startCellPos.y != cellPos.y) {\r\n                    this.isCanMove = false;\r\n                    var changeModels = this.selectCell(cellPos);\r\n                }\r\n            }\r\n        }, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END, function (eventTouch) {\r\n            // console.log(\"1111\");\r\n        }, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, function (eventTouch) {\r\n            // console.log(\"1111\");\r\n        }, this);\r\n    },\r\n    // 根据点击的像素位置，转换成网格中的位置\r\n    convertTouchPosToCell: function (pos) {\r\n        pos = this.node.convertToNodeSpace(pos);\r\n        if (pos.x < 0 || pos.x >= GRID_PIXEL_WIDTH || pos.y < 0 || pos.y >= GRID_PIXEL_HEIGHT) {\r\n            return false;\r\n        }\r\n        var x = Math.floor(pos.x / CELL_WIDTH) + 1;\r\n        var y = Math.floor(pos.y / CELL_HEIGHT) + 1;\r\n        return cc.v2(x, y);\r\n    },\r\n    // 移动格子\r\n    updateView: function (changeModels) {\r\n        let newCellViewInfo = [];\r\n        for (var i in changeModels) {\r\n            var model = changeModels[i];\r\n            var viewInfo = this.findViewByModel(model);\r\n            var view = null;\r\n            // 如果原来的cell不存在，则新建\r\n            if (!viewInfo) {\r\n                var type = model.type;\r\n                var aniView = cc.instantiate(this.aniPre[type]);\r\n                aniView.parent = this.node;\r\n                var cellViewScript = aniView.getComponent(\"CellView\");\r\n                cellViewScript.initWithModel(model);\r\n                view = aniView;\r\n            }\r\n            // 如果已经存在\r\n            else {\r\n                view = viewInfo.view;\r\n                this.cellViews[viewInfo.y][viewInfo.x] = null;\r\n            }\r\n            var cellScript = view.getComponent(\"CellView\");\r\n            cellScript.updateView();// 执行移动动作\r\n            if (!model.isDeath) {\r\n                newCellViewInfo.push({\r\n                    model: model,\r\n                    view: view\r\n                });\r\n            }\r\n        }\r\n        // 重新标记this.cellviews的信息\r\n        newCellViewInfo.forEach(function (ele) {\r\n            let model = ele.model;\r\n            this.cellViews[model.y][model.x] = ele.view;\r\n        }, this);\r\n    },\r\n    // 显示选中的格子背景\r\n    updateSelect: function (pos) {\r\n        for (var i = 1; i <= 9; i++) {\r\n            for (var j = 1; j <= 9; j++) {\r\n                if (this.cellViews[i][j]) {\r\n                    var cellScript = this.cellViews[i][j].getComponent(\"CellView\");\r\n                    if (pos.x == j && pos.y == i) {\r\n                        cellScript.setSelect(true);\r\n                    }\r\n                    else {\r\n                        cellScript.setSelect(false);\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n\r\n    },\r\n    /**\r\n     * 根据cell的model返回对应的view\r\n     */\r\n    findViewByModel: function (model) {\r\n        for (var i = 1; i <= 9; i++) {\r\n            for (var j = 1; j <= 9; j++) {\r\n                if (this.cellViews[i][j] && this.cellViews[i][j].getComponent(\"CellView\").model == model) {\r\n                    return { view: this.cellViews[i][j], x: j, y: i };\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    },\r\n    getPlayAniTime: function (changeModels) {\r\n        if (!changeModels) {\r\n            return 0;\r\n        }\r\n        var maxTime = 0;\r\n        changeModels.forEach(function (ele) {\r\n            ele.cmd.forEach(function (cmd) {\r\n                if (maxTime < cmd.playTime + cmd.keepTime) {\r\n                    maxTime = cmd.playTime + cmd.keepTime;\r\n                }\r\n            }, this)\r\n        }, this);\r\n        return maxTime;\r\n    },\r\n    // 获得爆炸次数， 同一个时间算一个\r\n    getStep: function (effectsQueue) {\r\n        if (!effectsQueue) {\r\n            return 0;\r\n        }\r\n        return effectsQueue.reduce(function (maxValue, efffectCmd) {\r\n            return Math.max(maxValue, efffectCmd.step || 0);\r\n        }, 0);\r\n    },\r\n    //一段时间内禁止操作\r\n    disableTouch: function (time, step) {\r\n        if (time <= 0) {\r\n            return;\r\n        }\r\n        this.isInPlayAni = true;\r\n        this.node.runAction(cc.sequence(cc.delayTime(time), cc.callFunc(function () {\r\n            this.isInPlayAni = false;\r\n            this.audioUtils.playContinuousMatch(step);\r\n        }, this)));\r\n    },\r\n    // 正常击中格子后的操作\r\n    selectCell: function (cellPos) {\r\n        var result = this.controller.selectCell(cellPos); // 直接先丢给model处理数据逻辑\r\n        var changeModels = result[0]; // 有改变的cell，包含新生成的cell和生成马上摧毁的格子\r\n        var effectsQueue = result[1]; //各种特效\r\n        this.playEffect(effectsQueue);\r\n        this.disableTouch(this.getPlayAniTime(changeModels), this.getStep(effectsQueue));\r\n        this.updateView(changeModels);\r\n        this.controller.cleanCmd();\r\n        if (changeModels.length >= 2) {\r\n            this.updateSelect(cc.v2(-1, -1));\r\n            this.audioUtils.playSwap();\r\n        }\r\n        else {\r\n            this.updateSelect(cellPos);\r\n            this.audioUtils.playClick();\r\n        }\r\n        return changeModels;\r\n    },\r\n    playEffect: function (effectsQueue) {\r\n        this.effectLayer.getComponent(\"EffectLayer\").playEffects(effectsQueue);\r\n    }\r\n\r\n\r\n\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}