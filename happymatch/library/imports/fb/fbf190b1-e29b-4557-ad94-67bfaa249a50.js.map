{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\View/assets\\Script\\View\\CellView.js"],"names":["cc","Class","extends","Component","properties","defaultFrame","default","type","SpriteFrame","onLoad","isSelect","initWithModel","model","x","startX","y","startY","node","CELL_WIDTH","CELL_HEIGHT","animation","getComponent","Animation","status","CELL_STATUS","COMMON","stop","play","updateView","cmd","length","actionArray","curTime","i","playTime","delay","delayTime","push","action","pos","move","moveTo","ANITIME","TOUCH_MOVE","v2","BIRD","BOMB_BIRD_DELAY","callFunc","destroy","isVisible","opacity","rotateRight","rotateBy","rotateLeft","repeat","sequence","keepTime","runAction","setSelect","flag","bg","getChildByName","Sprite","spriteFrame","CLICK","active"],"mappings":";;;;;;AAAA;;AAEAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,sBAAa;AACTC,qBAAS,IADA;AAETC,kBAAMP,GAAGQ;AAFA;AAXL,KAHP;;AAoBL;AACAC,YAAQ,kBAAY;AAChB;AACA,aAAKC,QAAL,GAAgB,KAAhB;AACH,KAxBI;AAyBLC,mBAAe,uBAASC,KAAT,EAAe;AAC1B,aAAKA,KAAL,GAAaA,KAAb;AACA,YAAIC,IAAID,MAAME,MAAd;AACA,YAAIC,IAAIH,MAAMI,MAAd;AACA,aAAKC,IAAL,CAAUJ,CAAV,GAAcK,0BAAcL,IAAI,GAAlB,CAAd;AACA,aAAKI,IAAL,CAAUF,CAAV,GAAcI,2BAAeJ,IAAI,GAAnB,CAAd;AACA,YAAIK,YAAa,KAAKH,IAAL,CAAUI,YAAV,CAAuBrB,GAAGsB,SAA1B,CAAjB;AACA,YAAIV,MAAMW,MAAN,IAAgBC,wBAAYC,MAAhC,EAAuC;AACnCL,sBAAUM,IAAV;AACH,SAFD,MAGI;AACAN,sBAAUO,IAAV,CAAef,MAAMW,MAArB;AACH;AACJ,KAtCI;AAuCL;AACAK,gBAAY,sBAAU;AAAA;;AAClB,YAAIC,MAAM,KAAKjB,KAAL,CAAWiB,GAArB;AACA,YAAGA,IAAIC,MAAJ,IAAc,CAAjB,EAAmB;AACf;AACH;AACD,YAAIC,cAAc,EAAlB;AACA,YAAIC,UAAU,CAAd;AACA,aAAI,IAAIC,CAAR,IAAaJ,GAAb,EAAiB;AACb,gBAAIA,IAAII,CAAJ,EAAOC,QAAP,GAAkBF,OAAtB,EAA8B;AAC1B,oBAAIG,QAAQnC,GAAGoC,SAAH,CAAaP,IAAII,CAAJ,EAAOC,QAAP,GAAkBF,OAA/B,CAAZ;AACAD,4BAAYM,IAAZ,CAAiBF,KAAjB;AACH;AACD,gBAAGN,IAAII,CAAJ,EAAOK,MAAP,IAAiB,QAApB,EAA6B;AACzB,oBAAIzB,IAAI,CAACgB,IAAII,CAAJ,EAAOM,GAAP,CAAW1B,CAAX,GAAe,GAAhB,IAAuBK,sBAA/B;AACA,oBAAIH,IAAI,CAACc,IAAII,CAAJ,EAAOM,GAAP,CAAWxB,CAAX,GAAe,GAAhB,IAAuBI,uBAA/B;AACA,oBAAIqB,OAAOxC,GAAGyC,MAAH,CAAUC,oBAAQC,UAAlB,EAA8B3C,GAAG4C,EAAH,CAAM/B,CAAN,EAAQE,CAAR,CAA9B,CAAX;AACAgB,4BAAYM,IAAZ,CAAiBG,IAAjB;AACH,aALD,MAMK,IAAGX,IAAII,CAAJ,EAAOK,MAAP,IAAiB,OAApB,EAA4B;AAC7B,oBAAG,KAAKf,MAAL,IAAeC,wBAAYqB,IAA9B,EAAmC;AAC/B,wBAAIzB,YAAY,KAAKH,IAAL,CAAUI,YAAV,CAAuBrB,GAAGsB,SAA1B,CAAhB;AACAF,8BAAUO,IAAV,CAAe,QAAf;AACAI,gCAAYM,IAAZ,CAAiBrC,GAAGoC,SAAH,CAAaM,oBAAQI,eAArB,CAAjB;AACH;AACD,oBAAIC,WAAW/C,GAAG+C,QAAH,CAAY,YAAU;AACjC,yBAAK9B,IAAL,CAAU+B,OAAV;AACH,iBAFc,EAEb,IAFa,CAAf;AAGAjB,4BAAYM,IAAZ,CAAiBU,QAAjB;AACH,aAVI,MAWA,IAAGlB,IAAII,CAAJ,EAAOK,MAAP,IAAiB,YAApB,EAAiC;AAAA;AAClC,wBAAIW,YAAYpB,IAAII,CAAJ,EAAOgB,SAAvB;AACAlB,gCAAYM,IAAZ,CAAiBrC,GAAG+C,QAAH,CAAY,YAAU;AACnC,4BAAGE,SAAH,EAAa;AACT,iCAAKhC,IAAL,CAAUiC,OAAV,GAAoB,GAApB;AACH,yBAFD,MAGI;AACA,iCAAKjC,IAAL,CAAUiC,OAAV,GAAoB,CAApB;AACH;AACJ,qBAPgB,QAAjB;AAFkC;AAUrC,aAVI,MAWA,IAAGrB,IAAII,CAAJ,EAAOK,MAAP,IAAiB,SAApB,EAA8B;AAC/B,oBAAIa,cAAcnD,GAAGoD,QAAH,CAAY,IAAZ,EAAiB,EAAjB,CAAlB;AACA,oBAAIC,aAAarD,GAAGoD,QAAH,CAAY,IAAZ,EAAkB,CAAC,EAAnB,CAAjB;AACArB,4BAAYM,IAAZ,CAAiBrC,GAAGsD,MAAH,CAAUtD,GAAGuD,QAAH,CAAYJ,WAAZ,EAAyBE,UAAzB,EAAqCF,WAArC,CAAV,EAA6D,CAA7D,CAAjB;AACH;AACDnB,sBAAUH,IAAII,CAAJ,EAAOC,QAAP,GAAkBL,IAAII,CAAJ,EAAOuB,QAAnC;AACH;;AAED,YAAGzB,YAAYD,MAAZ,IAAsB,CAAzB,EAA2B;AACvB,iBAAKb,IAAL,CAAUwC,SAAV,CAAoB1B,YAAY,CAAZ,CAApB;AACH,SAFD,MAGI;AAAA;;AACA,iBAAKd,IAAL,CAAUwC,SAAV,CAAoB,WAAGF,QAAH,YAAexB,WAAf,CAApB;AACH;AAEJ,KA/FI;AAgGL;AACA;;AAEA;AACA2B,eAAW,mBAASC,IAAT,EAAc;AACrB,YAAIvC,YAAY,KAAKH,IAAL,CAAUI,YAAV,CAAuBrB,GAAGsB,SAA1B,CAAhB;AACA,YAAIsC,KAAK,KAAK3C,IAAL,CAAU4C,cAAV,CAAyB,QAAzB,CAAT;AACA,YAAGF,QAAQ,KAAR,IAAiB,KAAKjD,QAAtB,IAAkC,KAAKE,KAAL,CAAWW,MAAX,IAAqBC,wBAAYC,MAAtE,EAA6E;AACzEL,sBAAUM,IAAV;AACA,iBAAKT,IAAL,CAAUI,YAAV,CAAuBrB,GAAG8D,MAA1B,EAAkCC,WAAlC,GAAgD,KAAK1D,YAArD;AACH,SAHD,MAIK,IAAGsD,QAAQ,KAAK/C,KAAL,CAAWW,MAAX,IAAqBC,wBAAYC,MAA5C,EAAmD;AACpDL,sBAAUO,IAAV,CAAeH,wBAAYwC,KAA3B;AACH,SAFI,MAGA,IAAGL,QAAQ,KAAK/C,KAAL,CAAWW,MAAX,IAAqBC,wBAAYqB,IAA5C,EAAiD;AAClDzB,sBAAUO,IAAV,CAAeH,wBAAYwC,KAA3B;AACH;AACDJ,WAAGK,MAAH,GAAYN,IAAZ;AACA,aAAKjD,QAAL,GAAgBiD,IAAhB;AACH;AAnHI,CAAT","file":"CellView.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\View","sourcesContent":["import {CELL_STATUS, CELL_WIDTH, CELL_HEIGHT, ANITIME} from '../Model/ConstValue';\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        defaultFrame:{\r\n            default: null,\r\n            type: cc.SpriteFrame\r\n        }\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        //this.model = null;\r\n        this.isSelect = false;\r\n    },\r\n    initWithModel: function(model){\r\n        this.model = model;\r\n        var x = model.startX;\r\n        var y = model.startY;\r\n        this.node.x = CELL_WIDTH * (x - 0.5);\r\n        this.node.y = CELL_HEIGHT * (y - 0.5);\r\n        var animation  = this.node.getComponent(cc.Animation);\r\n        if (model.status == CELL_STATUS.COMMON){\r\n            animation.stop();\r\n        } \r\n        else{\r\n            animation.play(model.status);\r\n        }\r\n    },\r\n    // 执行移动动作\r\n    updateView: function(){\r\n        var cmd = this.model.cmd;\r\n        if(cmd.length <= 0){\r\n            return ;\r\n        }\r\n        var actionArray = [];\r\n        var curTime = 0;\r\n        for(var i in cmd){\r\n            if( cmd[i].playTime > curTime){\r\n                var delay = cc.delayTime(cmd[i].playTime - curTime);\r\n                actionArray.push(delay);\r\n            }\r\n            if(cmd[i].action == \"moveTo\"){\r\n                var x = (cmd[i].pos.x - 0.5) * CELL_WIDTH;\r\n                var y = (cmd[i].pos.y - 0.5) * CELL_HEIGHT;\r\n                var move = cc.moveTo(ANITIME.TOUCH_MOVE, cc.v2(x,y));\r\n                actionArray.push(move);\r\n            }\r\n            else if(cmd[i].action == \"toDie\"){\r\n                if(this.status == CELL_STATUS.BIRD){\r\n                    let animation = this.node.getComponent(cc.Animation);\r\n                    animation.play(\"effect\");\r\n                    actionArray.push(cc.delayTime(ANITIME.BOMB_BIRD_DELAY));\r\n                }\r\n                var callFunc = cc.callFunc(function(){\r\n                    this.node.destroy();\r\n                },this);\r\n                actionArray.push(callFunc);\r\n            }\r\n            else if(cmd[i].action == \"setVisible\"){\r\n                let isVisible = cmd[i].isVisible;\r\n                actionArray.push(cc.callFunc(function(){\r\n                    if(isVisible){\r\n                        this.node.opacity = 255;\r\n                    }\r\n                    else{\r\n                        this.node.opacity = 0;\r\n                    }\r\n                },this));\r\n            }\r\n            else if(cmd[i].action == \"toShake\"){\r\n                let rotateRight = cc.rotateBy(0.06,30);\r\n                let rotateLeft = cc.rotateBy(0.12, -60);\r\n                actionArray.push(cc.repeat(cc.sequence(rotateRight, rotateLeft, rotateRight), 2));\r\n            }\r\n            curTime = cmd[i].playTime + cmd[i].keepTime;\r\n        }\r\n\r\n        if(actionArray.length == 1){\r\n            this.node.runAction(actionArray[0]);\r\n        }\r\n        else{\r\n            this.node.runAction(cc.sequence(...actionArray));\r\n        }\r\n\r\n    },\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n    setSelect: function(flag){\r\n        var animation = this.node.getComponent(cc.Animation);\r\n        var bg = this.node.getChildByName(\"select\");\r\n        if(flag == false && this.isSelect && this.model.status == CELL_STATUS.COMMON){\r\n            animation.stop();\r\n            this.node.getComponent(cc.Sprite).spriteFrame = this.defaultFrame;\r\n        }\r\n        else if(flag && this.model.status == CELL_STATUS.COMMON){\r\n            animation.play(CELL_STATUS.CLICK);\r\n        }\r\n        else if(flag && this.model.status == CELL_STATUS.BIRD){\r\n            animation.play(CELL_STATUS.CLICK);\r\n        }\r\n        bg.active = flag; \r\n        this.isSelect = flag;\r\n    }\r\n});\r\n"]}