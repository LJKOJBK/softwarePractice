{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Model/assets\\Script\\Model\\GameModel.js"],"names":["GameModel","cells","cellBgs","lastPos","cc","v2","cellTypeNum","cellCreateType","setCellTypeNum","i","GRID_WIDTH","j","GRID_HEIGHT","CellModel","result","init","getRandomCellType","checkPoint","length","setXY","setStartXY","data","x","y","checkWithDirection","direction","queue","vis","push","front","point","cellModel","tmpX","tmpY","type","rowResult","call","colResult","newCellStatus","CELL_STATUS","BIRD","WRAP","LINE","COLUMN","tmp","concat","forEach","newEle","flag","oldEle","printStr","console","log","pos","changeModels","effectsQueue","delta","Math","abs","curClickCell","lastClickCell","exchangeCell","result1","result2","curTime","pushToChangeModels","isCanBomb","status","COMMON","moveToAndBack","moveTo","ANITIME","TOUCH_MOVE","processCrush","cycleCount","bombModels","pos1","pos2","model1","model2","newCellType","model","crushCell","createNewCell","processBomb","DIE","down","CELL_TYPE","setStatus","setVisible","newCheckPoint","curRow","k","count","indexOf","cmd","num","createTypeList","CELL_BASENUM","index","floor","random","newBombModel","bombTime","BOMB_DELAY","addRowBomb","addColBomb","crushType","BOMB_BIRD_DELAY","playTime","step","action","needShake","toShake","shakeTime","DIE_SHAKE","toDie","addCrushEffect"],"mappings":"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","file":"GameModel.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Model","sourcesContent":["import CellModel from \"./CellModel\";\r\nimport { CELL_TYPE, CELL_BASENUM, CELL_STATUS, GRID_WIDTH, GRID_HEIGHT, ANITIME } from \"./ConstValue\";\r\n\r\nexport default class GameModel {\r\n    constructor() {\r\n        this.cells = null;      // 记录grid上所有的格子的数组\r\n        this.cellBgs = null;\r\n        this.lastPos = cc.v2(-1, -1);\r\n        this.cellTypeNum = 5;   // 默认动物数\r\n        this.cellCreateType = []; // 生成动物的种类，如有4种动物，数组为[1, 2, 3, 4]\r\n    }\r\n\r\n    // 初始化所有的格子\r\n    init(cellTypeNum) {\r\n        this.cells = [];\r\n        this.setCellTypeNum(cellTypeNum || this.cellTypeNum);\r\n        for (let i = 1; i <= GRID_WIDTH; i++) {\r\n            this.cells[i] = [];\r\n            for (let j = 1; j <= GRID_HEIGHT; j++) {\r\n                this.cells[i][j] = new CellModel();\r\n            }\r\n        }\r\n\r\n        for (let i = 1; i <= GRID_WIDTH; i++) {\r\n            for (let j = 1; j <= GRID_HEIGHT; j++) {\r\n                let result = []\r\n                do {\r\n                    this.cells[i][j].init(this.getRandomCellType());\r\n                    result = this.checkPoint(j, i)[0];\r\n                } while(result.length > 2);\r\n\r\n                this.cells[i][j].setXY(j, i);\r\n                this.cells[i][j].setStartXY(j, i);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    initWithData(data) {\r\n        // to do\r\n    }\r\n\r\n    checkPoint(x, y) {\r\n        // 给定一个坐标和要检查的方向，返回方向上包括自己在内同类元素的坐标  @returns: [cc.v2(), ...]\r\n        let checkWithDirection = function (x, y, direction) {\r\n            let queue = [];\r\n            let vis = [];   // 如果当前格子已被遍历过设为true\r\n            vis[x + y * 9] = true;\r\n            queue.push(cc.v2(x, y));\r\n            let front = 0;\r\n            while (front < queue.length) {\r\n                //let direction = [cc.v2(0, -1), cc.v2(0, 1), cc.v2(1, 0), cc.v2(-1, 0)];\r\n                let point = queue[front];\r\n                let cellModel = this.cells[point.y][point.x];   // 当前要检测的格子\r\n                front++;\r\n                if (!cellModel) {\r\n                    continue;\r\n                }\r\n                for (let i = 0; i < direction.length; i++) {\r\n                    let tmpX = point.x + direction[i].x;\r\n                    let tmpY = point.y + direction[i].y;\r\n                    if (tmpX < 1 || tmpX > 9    // 不合理的位置\r\n                        || tmpY < 1 || tmpY > 9\r\n                        || vis[tmpX + tmpY * 9]\r\n                        || !this.cells[tmpY][tmpX]) {\r\n                        continue;\r\n                    }\r\n                    if (cellModel.type == this.cells[tmpY][tmpX].type) {\r\n                        vis[tmpX + tmpY * 9] = true;\r\n                        queue.push(cc.v2(tmpX, tmpY));\r\n                    }\r\n                }\r\n            }\r\n            return queue;\r\n        }\r\n        let rowResult = checkWithDirection.call(this, x, y, [cc.v2(1, 0), cc.v2(-1, 0)]);   // 同一行相同个数\r\n        let colResult = checkWithDirection.call(this, x, y, [cc.v2(0, -1), cc.v2(0, 1)]);   // 同一列相同个数\r\n        let result = [];\r\n        let newCellStatus = \"\";\r\n        if (rowResult.length >= 5 || colResult.length >= 5) {\r\n            newCellStatus = CELL_STATUS.BIRD;   // 行列有超过五个生成魔力鸟（种类消除）\r\n        } else if (rowResult.length >= 3 && colResult.length >= 3) {\r\n            newCellStatus = CELL_STATUS.WRAP;   // 行列同时超过三个生成区域消除\r\n        } else if (rowResult.length >= 4) {\r\n            newCellStatus = CELL_STATUS.LINE;   // 生成行消除\r\n        } else if (colResult.length >= 4) {\r\n            newCellStatus = CELL_STATUS.COLUMN; // 生成列消除\r\n        }\r\n\r\n        if (rowResult.length >= 3) {\r\n            result = rowResult;\r\n        }\r\n        if (colResult.length >= 3) {\r\n            let tmp = result.concat();\r\n            colResult.forEach(function (newEle) {\r\n                let flag = false;\r\n                tmp.forEach(function (oldEle) {\r\n                    if (newEle.x == oldEle.x && newEle.y == oldEle.y) {\r\n                        flag = true;\r\n                    }\r\n                }, this);\r\n                if (!flag) {\r\n                    result.push(newEle);\r\n                }\r\n            }, this);\r\n        }\r\n        return [result, newCellStatus, this.cells[y][x].type];\r\n    }\r\n\r\n    printInfo() {\r\n        for (let i = 1; i <= 9; i++) {\r\n            let printStr = \"\";\r\n            for (let j = 1; j <= 9; j++) {\r\n                printStr += this.cells[i][j].type + \" \";\r\n            }\r\n            console.log(printStr);\r\n        }\r\n    }\r\n\r\n    getCells() {\r\n        return this.cells;\r\n    }\r\n\r\n    // controller调用的主要入口\r\n    // 点击某个格子，进行格子的移动等效果\r\n    selectCell(pos) {\r\n        this.changeModels = [];// 发生改变的model，将作为返回值，给view播动作 [cell, ...]\r\n        this.effectsQueue = []; // 动物消失，爆炸等特效\r\n        let lastPos = this.lastPos;\r\n        let delta = Math.abs(pos.x - lastPos.x) + Math.abs(pos.y - lastPos.y);\r\n        \r\n        if (delta != 1) { // 非相邻格子，直接返回\r\n            this.lastPos = pos;\r\n            return [[], []];\r\n        }\r\n        let curClickCell = this.cells[pos.y][pos.x]; // 获取当前点击的格子\r\n        let lastClickCell = this.cells[lastPos.y][lastPos.x]; // 上一次点击的格子\r\n        this.exchangeCell(lastPos, pos);    // 两个格子进行交换\r\n\r\n        let result1 = this.checkPoint(pos.x, pos.y)[0];\r\n        let result2 = this.checkPoint(lastPos.x, lastPos.y)[0];\r\n        this.curTime = 0; // 动画播放的当前时间\r\n        this.pushToChangeModels(curClickCell);\r\n        this.pushToChangeModels(lastClickCell);\r\n\r\n        let isCanBomb = (curClickCell.status != CELL_STATUS.COMMON && lastClickCell.status != CELL_STATUS.COMMON)\r\n            || curClickCell.status == CELL_STATUS.BIRD\r\n            || lastClickCell.status == CELL_STATUS.BIRD;\r\n\r\n        if (result1.length < 3 && result2.length < 3 && !isCanBomb) { // 不会发生消除的情况\r\n            this.exchangeCell(lastPos, pos);    // 恢复原来位置\r\n            curClickCell.moveToAndBack(lastPos);\r\n            lastClickCell.moveToAndBack(pos);\r\n            this.lastPos = cc.v2(-1, -1);\r\n            return [this.changeModels];\r\n        } else {\r\n            this.lastPos = cc.v2(-1, -1);\r\n            curClickCell.moveTo(lastPos, this.curTime);\r\n            lastClickCell.moveTo(pos, this.curTime);\r\n            let checkPoint = [pos, lastPos];\r\n            this.curTime += ANITIME.TOUCH_MOVE;\r\n            this.processCrush(checkPoint);\r\n            return [this.changeModels, this.effectsQueue];\r\n        }\r\n    }\r\n\r\n    // 消除 @params: [当前位置, 来源位置]\r\n    processCrush(checkPoint) {\r\n        let cycleCount = 0;\r\n        while (checkPoint.length > 0) {\r\n            let bombModels = [];    // 特殊元素进行爆炸\r\n            if (cycleCount == 0 && checkPoint.length == 2) { // 特殊消除\r\n                let pos1 = checkPoint[0];\r\n                let pos2 = checkPoint[1];\r\n                let model1 = this.cells[pos1.y][pos1.x];\r\n                let model2 = this.cells[pos2.y][pos2.x];\r\n                if (model1.status == CELL_STATUS.BIRD || model2.status == CELL_STATUS.BIRD) {\r\n                    if (model1.status == CELL_STATUS.BIRD) {\r\n                        model1.type = model2.type;\r\n                        bombModels.push(model1);\r\n                    } else {\r\n                        model2.type = model1.type;\r\n                        bombModels.push(model2);\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (let i in checkPoint) {\r\n                let pos = checkPoint[i];\r\n                if (!this.cells[pos.y][pos.x]) continue;\r\n                \r\n                let [result, newCellStatus, newCellType] = this.checkPoint(pos.x, pos.y);\r\n\r\n                if (result.length < 3) continue;\r\n                \r\n                for (let j in result) {\r\n                    let model = this.cells[result[j].y][result[j].x];\r\n                    this.crushCell(result[j].x, result[j].y, false, cycleCount);\r\n                    if (model.status != CELL_STATUS.COMMON) {\r\n                        bombModels.push(model);\r\n                    }\r\n                }\r\n                this.createNewCell(pos, newCellStatus, newCellType);\r\n            }\r\n            this.processBomb(bombModels, cycleCount);\r\n            this.curTime += ANITIME.DIE;\r\n            checkPoint = this.down();\r\n            cycleCount++;\r\n        }\r\n    }\r\n\r\n    //生成新cell\r\n    createNewCell(pos, status, type) {\r\n        if (status == \"\") {\r\n            return;\r\n        }\r\n        if (status == CELL_STATUS.BIRD) {\r\n            type = CELL_TYPE.BIRD\r\n        }\r\n        let model = new CellModel();\r\n        this.cells[pos.y][pos.x] = model\r\n        model.init(type);\r\n        model.setStartXY(pos.x, pos.y);\r\n        model.setXY(pos.x, pos.y);\r\n        model.setStatus(status);\r\n        model.setVisible(0, false);\r\n        model.setVisible(this.curTime, true);\r\n        this.changeModels.push(model);\r\n    }\r\n\r\n    // 下落\r\n    down() {\r\n        let newCheckPoint = [];\r\n        for (let i = 1; i <= GRID_WIDTH; i++) {\r\n            for (let j = 1; j <= GRID_HEIGHT; j++) {\r\n                if (this.cells[i][j] == null) {\r\n                    let curRow = i;\r\n                    for (let k = curRow; k <= GRID_HEIGHT; k++) {\r\n                        if (this.cells[k][j]) {\r\n                            this.pushToChangeModels(this.cells[k][j]);\r\n                            newCheckPoint.push(this.cells[k][j]);\r\n                            this.cells[curRow][j] = this.cells[k][j];\r\n                            this.cells[k][j] = null;\r\n                            this.cells[curRow][j].setXY(j, curRow);\r\n                            this.cells[curRow][j].moveTo(cc.v2(j, curRow), this.curTime);\r\n                            curRow++;\r\n                        }\r\n                    }\r\n                    let count = 1;\r\n                    for (let k = curRow; k <= GRID_HEIGHT; k++) {\r\n                        this.cells[k][j] = new CellModel();\r\n                        this.cells[k][j].init(this.getRandomCellType());\r\n                        this.cells[k][j].setStartXY(j, count + GRID_HEIGHT);\r\n                        this.cells[k][j].setXY(j, count + GRID_HEIGHT);\r\n                        this.cells[k][j].moveTo(cc.v2(j, k), this.curTime);\r\n                        count++;\r\n                        this.changeModels.push(this.cells[k][j]);\r\n                        newCheckPoint.push(this.cells[k][j]);\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n        this.curTime += ANITIME.TOUCH_MOVE + 0.3\r\n        return newCheckPoint;\r\n    }\r\n\r\n    pushToChangeModels(model) {\r\n        if (this.changeModels.indexOf(model) != -1) {\r\n            return;\r\n        }\r\n        this.changeModels.push(model);\r\n    }\r\n\r\n    cleanCmd() {\r\n        for (let i = 1; i <= GRID_WIDTH; i++) {\r\n            for (let j = 1; j <= GRID_HEIGHT; j++) {\r\n                if (this.cells[i][j]) {\r\n                    this.cells[i][j].cmd = [];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    exchangeCell(pos1, pos2) {\r\n        [this.cells[pos1.y][pos1.x], this.cells[pos2.y][pos2.x]] = [this.cells[pos2.y][pos2.x], this.cells[pos1.y][pos1.x]];\r\n    }\r\n\r\n    // 设置种类\r\n    // Todo 改成乱序算法\r\n    setCellTypeNum(num) {\r\n        console.log(\"num = \", num);\r\n        this.cellTypeNum = num;\r\n        this.cellCreateType = [];\r\n        let createTypeList = this.cellCreateType;\r\n        for (let i = 1; i <= CELL_BASENUM; i++) {\r\n            createTypeList.push(i);\r\n        }\r\n        for (let i = 0; i < createTypeList.length; i++) {\r\n            let index = Math.floor(Math.random() * (CELL_BASENUM - i)) + i;\r\n            createTypeList[i], createTypeList[index] = createTypeList[index], createTypeList[i]\r\n        }\r\n    }\r\n\r\n    // 随要生成一个类型\r\n    getRandomCellType() {\r\n        let index = Math.floor(Math.random() * this.cellTypeNum);\r\n        return this.cellCreateType[index];\r\n    }\r\n\r\n    // TODO bombModels去重\r\n    processBomb(bombModels, cycleCount) {\r\n        while (bombModels.length > 0) {\r\n            let newBombModel = [];\r\n            let bombTime = ANITIME.BOMB_DELAY;\r\n            bombModels.forEach(function (model) {\r\n                switch(model.status) {\r\n                    case CELL_STATUS.LINE: {\r\n                        for (let i = 1; i <= GRID_WIDTH; i++) {\r\n                            if (this.cells[model.y][i]) {\r\n                                if (this.cells[model.y][i].status != CELL_STATUS.COMMON) {\r\n                                    newBombModel.push(this.cells[model.y][i]);\r\n                                }\r\n                                this.crushCell(i, model.y, false, cycleCount);\r\n                            }\r\n                        }\r\n                        this.addRowBomb(this.curTime, cc.v2(model.x, model.y));\r\n                        break\r\n                    }\r\n                    case CELL_STATUS.COLUMN: {\r\n                        for (let i = 1; i <= GRID_HEIGHT; i++) {\r\n                            if (this.cells[i][model.x]) {\r\n                                if (this.cells[i][model.x].status != CELL_STATUS.COMMON) {\r\n                                    newBombModel.push(this.cells[i][model.x]);\r\n                                }\r\n                                this.crushCell(model.x, i, false, cycleCount);\r\n                            }\r\n                        }\r\n                        this.addColBomb(this.curTime, cc.v2(model.x, model.y));\r\n                        break\r\n                    }\r\n                    case CELL_STATUS.WRAP: {\r\n                        let x = model.x;\r\n                        let y = model.y;\r\n                        for (let i = 1; i <= GRID_HEIGHT; i++) {\r\n                            for (let j = 1; j <= GRID_WIDTH; j++) {\r\n                                let delta = Math.abs(x - j) + Math.abs(y - i);\r\n                                if (this.cells[i][j] && delta <= 2) {\r\n                                    if (this.cells[i][j].status != CELL_STATUS.COMMON) {\r\n                                        newBombModel.push(this.cells[i][j]);\r\n                                    }\r\n                                    this.crushCell(j, i, false, cycleCount);\r\n                                }\r\n                            }\r\n                        }\r\n                        break\r\n                    }\r\n                    case CELL_STATUS.BIRD: {\r\n                        let crushType = model.type\r\n                        if (bombTime < ANITIME.BOMB_BIRD_DELAY) {\r\n                            bombTime = ANITIME.BOMB_BIRD_DELAY;\r\n                        }\r\n                        if (crushType == CELL_TYPE.BIRD) {\r\n                            crushType = this.getRandomCellType();\r\n                        }\r\n                        for (let i = 1; i <= GRID_HEIGHT; i++) {\r\n                            for (let j = 1; j <= GRID_WIDTH; j++) {\r\n                                if (this.cells[i][j] && this.cells[i][j].type == crushType) {\r\n                                    if (this.cells[i][j].status != CELL_STATUS.COMMON) {\r\n                                        newBombModel.push(this.cells[i][j]);\r\n                                    }\r\n                                    this.crushCell(j, i, true, cycleCount);\r\n                                }\r\n                            }\r\n                        }\r\n                        break\r\n                    }\r\n                    default: break\r\n                }\r\n            }, this);\r\n            if (bombModels.length > 0) {\r\n                this.curTime += bombTime;\r\n            }\r\n            bombModels = newBombModel;\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     * @param {开始播放的时间} playTime \r\n     * @param {*cell位置} pos \r\n     * @param {*第几次消除，用于播放音效} step \r\n     */\r\n    addCrushEffect(playTime, pos, step) {\r\n        this.effectsQueue.push({\r\n            playTime,\r\n            pos,\r\n            action: \"crush\",\r\n            step\r\n        });\r\n    }\r\n\r\n    addRowBomb(playTime, pos) {\r\n        this.effectsQueue.push({\r\n            playTime,\r\n            pos,\r\n            action: \"rowBomb\"\r\n        });\r\n    }\r\n\r\n    addColBomb(playTime, pos) {\r\n        this.effectsQueue.push({\r\n            playTime,\r\n            pos,\r\n            action: \"colBomb\"\r\n        });\r\n    }\r\n\r\n    addWrapBomb(playTime, pos) {\r\n        // TODO\r\n    }\r\n    // cell消除逻辑\r\n    crushCell(x, y, needShake, step) {\r\n        let model = this.cells[y][x];\r\n        this.pushToChangeModels(model);\r\n        if (needShake) {\r\n            model.toShake(this.curTime)\r\n        }\r\n\r\n        let shakeTime = needShake ? ANITIME.DIE_SHAKE : 0;\r\n        model.toDie(this.curTime + shakeTime);\r\n        this.addCrushEffect(this.curTime + shakeTime, cc.v2(model.x, model.y), step);\r\n        this.cells[y][x] = null;\r\n    }\r\n\r\n}\r\n\r\n"]}