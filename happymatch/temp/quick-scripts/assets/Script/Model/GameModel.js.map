{"version":3,"sources":["GameModel.js"],"names":["GameModel","cells","cellBgs","lastPos","cc","v2","cellTypeNum","cellCreateType","setCellTypeNum","i","GRID_WIDTH","j","GRID_HEIGHT","CellModel","flag","init","getRandomCellType","result","checkPoint","length","setXY","setStartXY","data","x","y","checkWithDirection","direction","queue","vis","push","front","point","cellModel","tmpX","tmpY","type","rowResult","call","colResult","newCellStatus","CELL_STATUS","BIRD","WRAP","LINE","COLUMN","tmp","concat","forEach","newEle","oldEle","printStr","console","log","pos","changeModels","effectsQueue","delta","Math","abs","curClickCell","lastClickCell","exchangeCell","result1","result2","curTime","pushToChangeModels","isCanBomb","status","COMMON","moveToAndBack","moveTo","ANITIME","TOUCH_MOVE","processCrush","cycleCount","bombModels","pos1","pos2","model1","model2","bombModel","newCellType","model","crushCell","createNewCell","processBomb","DIE","down","CELL_TYPE","setStatus","setVisible","newCheckPoint","curRow","k","count","indexOf","cmd","tmpModel","num","createTypeList","CELL_BASENUM","index","floor","random","newBombModel","bombTime","BOMB_DELAY","addRowBomb","addColBomb","crushType","BOMB_BIRD_DELAY","playTime","step","action","needShake","toShake","shakeTime","DIE_SHAKE","toDie","addCrushEffect"],"mappings":";;;;;;;;;;;;;;;AAAA;;;;AACA;;;;;;IAEqBA;AACjB,yBAAc;AAAA;;AACV,aAAKC,KAAL,GAAa,IAAb;AACA,aAAKC,OAAL,GAAe,IAAf;AACA,aAAKC,OAAL,GAAeC,GAAGC,EAAH,CAAM,CAAC,CAAP,EAAU,CAAC,CAAX,CAAf;AACA,aAAKC,WAAL,GAAmB,CAAnB;AACA,aAAKC,cAAL,GAAsB,EAAtB,CALU,CAKgB;AAC7B;;;;6BAEID,aAAa;AACd,iBAAKL,KAAL,GAAa,EAAb;AACA,iBAAKO,cAAL,CAAoBF,eAAe,KAAKA,WAAxC;AACA,iBAAK,IAAIG,IAAI,CAAb,EAAgBA,KAAKC,sBAArB,EAAiCD,GAAjC,EAAsC;AAClC,qBAAKR,KAAL,CAAWQ,CAAX,IAAgB,EAAhB;AACA,qBAAK,IAAIE,IAAI,CAAb,EAAgBA,KAAKC,uBAArB,EAAkCD,GAAlC,EAAuC;AACnC,yBAAKV,KAAL,CAAWQ,CAAX,EAAcE,CAAd,IAAmB,IAAIE,mBAAJ,EAAnB;AACH;AACJ;;AAED,iBAAK,IAAIJ,IAAI,CAAb,EAAgBA,KAAKC,sBAArB,EAAiCD,GAAjC,EAAsC;AAClC,qBAAK,IAAIE,IAAI,CAAb,EAAgBA,KAAKC,uBAArB,EAAkCD,GAAlC,EAAuC;AACnC,wBAAIG,OAAO,IAAX;AACA,2BAAOA,IAAP,EAAa;AACTA,+BAAO,KAAP;AACA,6BAAKb,KAAL,CAAWQ,CAAX,EAAcE,CAAd,EAAiBI,IAAjB,CAAsB,KAAKC,iBAAL,EAAtB;AACA,4BAAIC,SAAS,KAAKC,UAAL,CAAgBP,CAAhB,EAAmBF,CAAnB,EAAsB,CAAtB,CAAb;AACA,4BAAIQ,OAAOE,MAAP,GAAgB,CAApB,EAAuB;AACnBL,mCAAO,IAAP;AACH;AACD,6BAAKb,KAAL,CAAWQ,CAAX,EAAcE,CAAd,EAAiBS,KAAjB,CAAuBT,CAAvB,EAA0BF,CAA1B;AACA,6BAAKR,KAAL,CAAWQ,CAAX,EAAcE,CAAd,EAAiBU,UAAjB,CAA4BV,CAA5B,EAA+BF,CAA/B;AACH;AACJ;AACJ;AAEJ;;;qCAEYa,MAAM;AACf;AACH;;;mCAEUC,GAAGC,GAAG;AACb,gBAAIC,qBAAqB,SAArBA,kBAAqB,CAAUF,CAAV,EAAaC,CAAb,EAAgBE,SAAhB,EAA2B;AAChD,oBAAIC,QAAQ,EAAZ;AACA,oBAAIC,MAAM,EAAV;AACAA,oBAAIL,IAAIC,IAAI,CAAZ,IAAiB,IAAjB;AACAG,sBAAME,IAAN,CAAWzB,GAAGC,EAAH,CAAMkB,CAAN,EAASC,CAAT,CAAX;AACA,oBAAIM,QAAQ,CAAZ;AACA,uBAAOA,QAAQH,MAAMR,MAArB,EAA6B;AACzB;AACA,wBAAIY,QAAQJ,MAAMG,KAAN,CAAZ;AACA,wBAAIE,YAAY,KAAK/B,KAAL,CAAW8B,MAAMP,CAAjB,EAAoBO,MAAMR,CAA1B,CAAhB;AACAO;AACA,wBAAI,CAACE,SAAL,EAAgB;AACZ;AACH;AACD,yBAAK,IAAIvB,IAAI,CAAb,EAAgBA,IAAIiB,UAAUP,MAA9B,EAAsCV,GAAtC,EAA2C;AACvC,4BAAIwB,OAAOF,MAAMR,CAAN,GAAUG,UAAUjB,CAAV,EAAac,CAAlC;AACA,4BAAIW,OAAOH,MAAMP,CAAN,GAAUE,UAAUjB,CAAV,EAAae,CAAlC;AACA,4BAAIS,OAAO,CAAP,IAAYA,OAAO,CAAnB,IACGC,OAAO,CADV,IACeA,OAAO,CADtB,IAEGN,IAAIK,OAAOC,OAAO,CAAlB,CAFH,IAGG,CAAC,KAAKjC,KAAL,CAAWiC,IAAX,EAAiBD,IAAjB,CAHR,EAGgC;AAC5B;AACH;AACD,4BAAID,UAAUG,IAAV,IAAkB,KAAKlC,KAAL,CAAWiC,IAAX,EAAiBD,IAAjB,EAAuBE,IAA7C,EAAmD;AAC/CP,gCAAIK,OAAOC,OAAO,CAAlB,IAAuB,IAAvB;AACAP,kCAAME,IAAN,CAAWzB,GAAGC,EAAH,CAAM4B,IAAN,EAAYC,IAAZ,CAAX;AACH;AACJ;AACJ;AACD,uBAAOP,KAAP;AACH,aA9BD;AA+BA,gBAAIS,YAAYX,mBAAmBY,IAAnB,CAAwB,IAAxB,EAA8Bd,CAA9B,EAAiCC,CAAjC,EAAoC,CAACpB,GAAGC,EAAH,CAAM,CAAN,EAAS,CAAT,CAAD,EAAcD,GAAGC,EAAH,CAAM,CAAC,CAAP,EAAU,CAAV,CAAd,CAApC,CAAhB;AACA,gBAAIiC,YAAYb,mBAAmBY,IAAnB,CAAwB,IAAxB,EAA8Bd,CAA9B,EAAiCC,CAAjC,EAAoC,CAACpB,GAAGC,EAAH,CAAM,CAAN,EAAS,CAAC,CAAV,CAAD,EAAeD,GAAGC,EAAH,CAAM,CAAN,EAAS,CAAT,CAAf,CAApC,CAAhB;AACA,gBAAIY,SAAS,EAAb;AACA,gBAAIsB,gBAAgB,EAApB;AACA,gBAAIH,UAAUjB,MAAV,IAAoB,CAApB,IAAyBmB,UAAUnB,MAAV,IAAoB,CAAjD,EAAoD;AAChDoB,gCAAgBC,wBAAYC,IAA5B;AACH,aAFD,MAGK,IAAIL,UAAUjB,MAAV,IAAoB,CAApB,IAAyBmB,UAAUnB,MAAV,IAAoB,CAAjD,EAAoD;AACrDoB,gCAAgBC,wBAAYE,IAA5B;AACH,aAFI,MAGA,IAAIN,UAAUjB,MAAV,IAAoB,CAAxB,EAA2B;AAC5BoB,gCAAgBC,wBAAYG,IAA5B;AACH,aAFI,MAGA,IAAIL,UAAUnB,MAAV,IAAoB,CAAxB,EAA2B;AAC5BoB,gCAAgBC,wBAAYI,MAA5B;AACH;AACD,gBAAIR,UAAUjB,MAAV,IAAoB,CAAxB,EAA2B;AACvBF,yBAASmB,SAAT;AACH;AACD,gBAAIE,UAAUnB,MAAV,IAAoB,CAAxB,EAA2B;AACvB,oBAAI0B,MAAM5B,OAAO6B,MAAP,EAAV;AACAR,0BAAUS,OAAV,CAAkB,UAAUC,MAAV,EAAkB;AAChC,wBAAIlC,OAAO,KAAX;AACA+B,wBAAIE,OAAJ,CAAY,UAAUE,MAAV,EAAkB;AAC1B,4BAAID,OAAOzB,CAAP,IAAY0B,OAAO1B,CAAnB,IAAwByB,OAAOxB,CAAP,IAAYyB,OAAOzB,CAA/C,EAAkD;AAC9CV,mCAAO,IAAP;AACH;AACJ,qBAJD,EAIG,IAJH;AAKA,wBAAI,CAACA,IAAL,EAAW;AACPG,+BAAOY,IAAP,CAAYmB,MAAZ;AACH;AACJ,iBAVD,EAUG,IAVH;AAWH;AACD,mBAAO,CAAC/B,MAAD,EAASsB,aAAT,EAAwB,KAAKtC,KAAL,CAAWuB,CAAX,EAAcD,CAAd,EAAiBY,IAAzC,CAAP;AACH;;;oCAEW;AACR,iBAAK,IAAI1B,IAAI,CAAb,EAAgBA,KAAK,CAArB,EAAwBA,GAAxB,EAA6B;AACzB,oBAAIyC,WAAW,EAAf;AACA,qBAAK,IAAIvC,IAAI,CAAb,EAAgBA,KAAK,CAArB,EAAwBA,GAAxB,EAA6B;AACzBuC,gCAAY,KAAKjD,KAAL,CAAWQ,CAAX,EAAcE,CAAd,EAAiBwB,IAAjB,GAAwB,GAApC;AACH;AACDgB,wBAAQC,GAAR,CAAYF,QAAZ;AACH;AACJ;;;mCAEU;AACP,mBAAO,KAAKjD,KAAZ;AACH;AACD;AACA;;;;mCACWoD,KAAK;AACZ,iBAAKC,YAAL,GAAoB,EAApB,CADY,CACW;AACvB,iBAAKC,YAAL,GAAoB,EAApB,CAFY,CAEY;AACxB,gBAAIpD,UAAU,KAAKA,OAAnB;AACA,gBAAIqD,QAAQC,KAAKC,GAAL,CAASL,IAAI9B,CAAJ,GAAQpB,QAAQoB,CAAzB,IAA8BkC,KAAKC,GAAL,CAASL,IAAI7B,CAAJ,GAAQrB,QAAQqB,CAAzB,CAA1C;AACA,gBAAIgC,SAAS,CAAb,EAAgB;AAAE;AACd,qBAAKrD,OAAL,GAAekD,GAAf;AACA,uBAAO,CAAC,EAAD,EAAK,EAAL,CAAP;AACH;AACD,gBAAIM,eAAe,KAAK1D,KAAL,CAAWoD,IAAI7B,CAAf,EAAkB6B,IAAI9B,CAAtB,CAAnB,CATY,CASiC;AAC7C,gBAAIqC,gBAAgB,KAAK3D,KAAL,CAAWE,QAAQqB,CAAnB,EAAsBrB,QAAQoB,CAA9B,CAApB,CAVY,CAU0C;AACtD,iBAAKsC,YAAL,CAAkB1D,OAAlB,EAA2BkD,GAA3B;AACA,gBAAIS,UAAU,KAAK5C,UAAL,CAAgBmC,IAAI9B,CAApB,EAAuB8B,IAAI7B,CAA3B,EAA8B,CAA9B,CAAd;AACA,gBAAIuC,UAAU,KAAK7C,UAAL,CAAgBf,QAAQoB,CAAxB,EAA2BpB,QAAQqB,CAAnC,EAAsC,CAAtC,CAAd;AACA,iBAAKwC,OAAL,GAAe,CAAf,CAdY,CAcM;AAClB,iBAAKC,kBAAL,CAAwBN,YAAxB;AACA,iBAAKM,kBAAL,CAAwBL,aAAxB;AACA,gBAAIM,YAAaP,aAAaQ,MAAb,IAAuB3B,wBAAY4B,MAAnC,IAA6C;AAC1DR,0BAAcO,MAAd,IAAwB3B,wBAAY4B,MADxB,IAEZT,aAAaQ,MAAb,IAAuB3B,wBAAYC,IAFvB,IAGZmB,cAAcO,MAAd,IAAwB3B,wBAAYC,IAHxC;AAIA,gBAAIqB,QAAQ3C,MAAR,GAAiB,CAAjB,IAAsB4C,QAAQ5C,MAAR,GAAiB,CAAvC,IAA4C,CAAC+C,SAAjD,EAA4D;AAAC;AACzD,qBAAKL,YAAL,CAAkB1D,OAAlB,EAA2BkD,GAA3B;AACAM,6BAAaU,aAAb,CAA2BlE,OAA3B;AACAyD,8BAAcS,aAAd,CAA4BhB,GAA5B;AACA,qBAAKlD,OAAL,GAAeC,GAAGC,EAAH,CAAM,CAAC,CAAP,EAAU,CAAC,CAAX,CAAf;AACA,uBAAO,CAAC,KAAKiD,YAAN,CAAP;AACH,aAND,MAOK;AACD,qBAAKnD,OAAL,GAAeC,GAAGC,EAAH,CAAM,CAAC,CAAP,EAAU,CAAC,CAAX,CAAf;AACAsD,6BAAaW,MAAb,CAAoBnE,OAApB,EAA6B,KAAK6D,OAAlC;AACAJ,8BAAcU,MAAd,CAAqBjB,GAArB,EAA0B,KAAKW,OAA/B;AACA,oBAAI9C,aAAa,CAACmC,GAAD,EAAMlD,OAAN,CAAjB;AACA,qBAAK6D,OAAL,IAAgBO,oBAAQC,UAAxB;AACA,qBAAKC,YAAL,CAAkBvD,UAAlB;AACA,uBAAO,CAAC,KAAKoC,YAAN,EAAoB,KAAKC,YAAzB,CAAP;AACH;AACJ;AACD;;;;qCACarC,YAAY;AACrB,gBAAIwD,aAAa,CAAjB;AACA,mBAAOxD,WAAWC,MAAX,GAAoB,CAA3B,EAA8B;AAC1B,oBAAIwD,aAAa,EAAjB;AACA,oBAAID,cAAc,CAAd,IAAmBxD,WAAWC,MAAX,IAAqB,CAA5C,EAA+C;AAAE;AAC7C,wBAAIyD,OAAO1D,WAAW,CAAX,CAAX;AACA,wBAAI2D,OAAO3D,WAAW,CAAX,CAAX;AACA,wBAAI4D,SAAS,KAAK7E,KAAL,CAAW2E,KAAKpD,CAAhB,EAAmBoD,KAAKrD,CAAxB,CAAb;AACA,wBAAIwD,SAAS,KAAK9E,KAAL,CAAW4E,KAAKrD,CAAhB,EAAmBqD,KAAKtD,CAAxB,CAAb;AACA,wBAAIuD,OAAOX,MAAP,IAAiB3B,wBAAYC,IAA7B,IAAqCsC,OAAOZ,MAAP,IAAiB3B,wBAAYC,IAAtE,EAA4E;AACxE,4BAAIuC,YAAY,IAAhB;AACA,4BAAIF,OAAOX,MAAP,IAAiB3B,wBAAYC,IAAjC,EAAuC;AACnCqC,mCAAO3C,IAAP,GAAc4C,OAAO5C,IAArB;AACAwC,uCAAW9C,IAAX,CAAgBiD,MAAhB;AACH,yBAHD,MAIK;AACDC,mCAAO5C,IAAP,GAAc2C,OAAO3C,IAArB;AACAwC,uCAAW9C,IAAX,CAAgBkD,MAAhB;AACH;AAEJ;AACJ;AACD,qBAAK,IAAItE,CAAT,IAAcS,UAAd,EAA0B;AACtB,wBAAImC,MAAMnC,WAAWT,CAAX,CAAV;AACA,wBAAI,CAAC,KAAKR,KAAL,CAAWoD,IAAI7B,CAAf,EAAkB6B,IAAI9B,CAAtB,CAAL,EAA+B;AAC3B;AACH;;AAJqB,sCAKqB,KAAKL,UAAL,CAAgBmC,IAAI9B,CAApB,EAAuB8B,IAAI7B,CAA3B,CALrB;AAAA;AAAA,wBAKjBP,MALiB;AAAA,wBAKTsB,aALS;AAAA,wBAKM0C,WALN;;AAOtB,wBAAIhE,OAAOE,MAAP,GAAgB,CAApB,EAAuB;AACnB;AACH;AACD,yBAAK,IAAIR,CAAT,IAAcM,MAAd,EAAsB;AAClB,4BAAIiE,QAAQ,KAAKjF,KAAL,CAAWgB,OAAON,CAAP,EAAUa,CAArB,EAAwBP,OAAON,CAAP,EAAUY,CAAlC,CAAZ;AACA,6BAAK4D,SAAL,CAAelE,OAAON,CAAP,EAAUY,CAAzB,EAA4BN,OAAON,CAAP,EAAUa,CAAtC,EAAyC,KAAzC,EAAgDkD,UAAhD;AACA,4BAAIQ,MAAMf,MAAN,IAAgB3B,wBAAY4B,MAAhC,EAAwC;AACpCO,uCAAW9C,IAAX,CAAgBqD,KAAhB;AACH;AACJ;AACD,yBAAKE,aAAL,CAAmB/B,GAAnB,EAAwBd,aAAxB,EAAuC0C,WAAvC;AAEH;AACD,qBAAKI,WAAL,CAAiBV,UAAjB,EAA6BD,UAA7B;AACA,qBAAKV,OAAL,IAAgBO,oBAAQe,GAAxB;AACApE,6BAAa,KAAKqE,IAAL,EAAb;AACAb;AACH;AACJ;;AAED;;;;sCACcrB,KAAKc,QAAQhC,MAAM;AAC7B,gBAAIgC,UAAU,EAAd,EAAkB;AACd;AACH;AACD,gBAAIA,UAAU3B,wBAAYC,IAA1B,EAAgC;AAC5BN,uBAAOqD,sBAAU/C,IAAjB;AACH;AACD,gBAAIyC,QAAQ,IAAIrE,mBAAJ,EAAZ;AACA,iBAAKZ,KAAL,CAAWoD,IAAI7B,CAAf,EAAkB6B,IAAI9B,CAAtB,IAA2B2D,KAA3B;AACAA,kBAAMnE,IAAN,CAAWoB,IAAX;AACA+C,kBAAM7D,UAAN,CAAiBgC,IAAI9B,CAArB,EAAwB8B,IAAI7B,CAA5B;AACA0D,kBAAM9D,KAAN,CAAYiC,IAAI9B,CAAhB,EAAmB8B,IAAI7B,CAAvB;AACA0D,kBAAMO,SAAN,CAAgBtB,MAAhB;AACAe,kBAAMQ,UAAN,CAAiB,CAAjB,EAAoB,KAApB;AACAR,kBAAMQ,UAAN,CAAiB,KAAK1B,OAAtB,EAA+B,IAA/B;AACA,iBAAKV,YAAL,CAAkBzB,IAAlB,CAAuBqD,KAAvB;AACH;AACD;;;;+BACO;AACH,gBAAIS,gBAAgB,EAApB;AACA,iBAAK,IAAIlF,IAAI,CAAb,EAAgBA,KAAKC,sBAArB,EAAiCD,GAAjC,EAAsC;AAClC,qBAAK,IAAIE,IAAI,CAAb,EAAgBA,KAAKC,uBAArB,EAAkCD,GAAlC,EAAuC;AACnC,wBAAI,KAAKV,KAAL,CAAWQ,CAAX,EAAcE,CAAd,KAAoB,IAAxB,EAA8B;AAC1B,4BAAIiF,SAASnF,CAAb;AACA,6BAAK,IAAIoF,IAAID,MAAb,EAAqBC,KAAKjF,uBAA1B,EAAuCiF,GAAvC,EAA4C;AACxC,gCAAI,KAAK5F,KAAL,CAAW4F,CAAX,EAAclF,CAAd,CAAJ,EAAsB;AAClB,qCAAKsD,kBAAL,CAAwB,KAAKhE,KAAL,CAAW4F,CAAX,EAAclF,CAAd,CAAxB;AACAgF,8CAAc9D,IAAd,CAAmB,KAAK5B,KAAL,CAAW4F,CAAX,EAAclF,CAAd,CAAnB;AACA,qCAAKV,KAAL,CAAW2F,MAAX,EAAmBjF,CAAnB,IAAwB,KAAKV,KAAL,CAAW4F,CAAX,EAAclF,CAAd,CAAxB;AACA,qCAAKV,KAAL,CAAW4F,CAAX,EAAclF,CAAd,IAAmB,IAAnB;AACA,qCAAKV,KAAL,CAAW2F,MAAX,EAAmBjF,CAAnB,EAAsBS,KAAtB,CAA4BT,CAA5B,EAA+BiF,MAA/B;AACA,qCAAK3F,KAAL,CAAW2F,MAAX,EAAmBjF,CAAnB,EAAsB2D,MAAtB,CAA6BlE,GAAGC,EAAH,CAAMM,CAAN,EAASiF,MAAT,CAA7B,EAA+C,KAAK5B,OAApD;AACA4B;AACH;AACJ;AACD,4BAAIE,QAAQ,CAAZ;AACA,6BAAK,IAAID,IAAID,MAAb,EAAqBC,KAAKjF,uBAA1B,EAAuCiF,GAAvC,EAA4C;AACxC,iCAAK5F,KAAL,CAAW4F,CAAX,EAAclF,CAAd,IAAmB,IAAIE,mBAAJ,EAAnB;AACA,iCAAKZ,KAAL,CAAW4F,CAAX,EAAclF,CAAd,EAAiBI,IAAjB,CAAsB,KAAKC,iBAAL,EAAtB;AACA,iCAAKf,KAAL,CAAW4F,CAAX,EAAclF,CAAd,EAAiBU,UAAjB,CAA4BV,CAA5B,EAA+BmF,QAAQlF,uBAAvC;AACA,iCAAKX,KAAL,CAAW4F,CAAX,EAAclF,CAAd,EAAiBS,KAAjB,CAAuBT,CAAvB,EAA0BmF,QAAQlF,uBAAlC;AACA,iCAAKX,KAAL,CAAW4F,CAAX,EAAclF,CAAd,EAAiB2D,MAAjB,CAAwBlE,GAAGC,EAAH,CAAMM,CAAN,EAASkF,CAAT,CAAxB,EAAqC,KAAK7B,OAA1C;AACA8B;AACA,iCAAKxC,YAAL,CAAkBzB,IAAlB,CAAuB,KAAK5B,KAAL,CAAW4F,CAAX,EAAclF,CAAd,CAAvB;AACAgF,0CAAc9D,IAAd,CAAmB,KAAK5B,KAAL,CAAW4F,CAAX,EAAclF,CAAd,CAAnB;AACH;AAEJ;AACJ;AACJ;AACD,iBAAKqD,OAAL,IAAgBO,oBAAQC,UAAR,GAAqB,GAArC;AACA,mBAAOmB,aAAP;AACH;;;2CAEkBT,OAAO;AACtB,gBAAI,KAAK5B,YAAL,CAAkByC,OAAlB,CAA0Bb,KAA1B,KAAoC,CAAC,CAAzC,EAA4C;AACxC;AACH;AACD,iBAAK5B,YAAL,CAAkBzB,IAAlB,CAAuBqD,KAAvB;AACH;;;mCAEU;AACP,iBAAK,IAAIzE,IAAI,CAAb,EAAgBA,KAAKC,sBAArB,EAAiCD,GAAjC,EAAsC;AAClC,qBAAK,IAAIE,IAAI,CAAb,EAAgBA,KAAKC,uBAArB,EAAkCD,GAAlC,EAAuC;AACnC,wBAAI,KAAKV,KAAL,CAAWQ,CAAX,EAAcE,CAAd,CAAJ,EAAsB;AAClB,6BAAKV,KAAL,CAAWQ,CAAX,EAAcE,CAAd,EAAiBqF,GAAjB,GAAuB,EAAvB;AACH;AACJ;AACJ;AACJ;;;qCAEYpB,MAAMC,MAAM;AACrB,gBAAIoB,WAAW,KAAKhG,KAAL,CAAW2E,KAAKpD,CAAhB,EAAmBoD,KAAKrD,CAAxB,CAAf;AACA,iBAAKtB,KAAL,CAAW2E,KAAKpD,CAAhB,EAAmBoD,KAAKrD,CAAxB,IAA6B,KAAKtB,KAAL,CAAW4E,KAAKrD,CAAhB,EAAmBqD,KAAKtD,CAAxB,CAA7B;AACA,iBAAKtB,KAAL,CAAW2E,KAAKpD,CAAhB,EAAmBoD,KAAKrD,CAAxB,EAA2BA,CAA3B,GAA+BqD,KAAKrD,CAApC;AACA,iBAAKtB,KAAL,CAAW2E,KAAKpD,CAAhB,EAAmBoD,KAAKrD,CAAxB,EAA2BC,CAA3B,GAA+BoD,KAAKpD,CAApC;AACA,iBAAKvB,KAAL,CAAW4E,KAAKrD,CAAhB,EAAmBqD,KAAKtD,CAAxB,IAA6B0E,QAA7B;AACA,iBAAKhG,KAAL,CAAW4E,KAAKrD,CAAhB,EAAmBqD,KAAKtD,CAAxB,EAA2BA,CAA3B,GAA+BsD,KAAKtD,CAApC;AACA,iBAAKtB,KAAL,CAAW4E,KAAKrD,CAAhB,EAAmBqD,KAAKtD,CAAxB,EAA2BC,CAA3B,GAA+BqD,KAAKrD,CAApC;AACH;AACD;AACA;;;;uCACe0E,KAAK;AAChB/C,oBAAQC,GAAR,CAAY,QAAZ,EAAsB8C,GAAtB;AACA,iBAAK5F,WAAL,GAAmB4F,GAAnB;AACA,iBAAK3F,cAAL,GAAsB,EAAtB;AACA,gBAAI4F,iBAAiB,KAAK5F,cAA1B;AACA,iBAAK,IAAIE,IAAI,CAAb,EAAgBA,KAAK2F,wBAArB,EAAmC3F,GAAnC,EAAwC;AACpC0F,+BAAetE,IAAf,CAAoBpB,CAApB;AACH;AACD,iBAAK,IAAIA,KAAI,CAAb,EAAgBA,KAAI0F,eAAehF,MAAnC,EAA2CV,IAA3C,EAAgD;AAC5C,oBAAI4F,QAAQ5C,KAAK6C,KAAL,CAAW7C,KAAK8C,MAAL,MAAiBH,2BAAe3F,EAAhC,CAAX,IAAiDA,EAA7D;AACA0F,+BAAe1F,EAAf,GAAmB0F,eAAeE,KAAf,IAAwBF,eAAeE,KAAf,CAA3C,EAAkEF,eAAe1F,EAAf,CAAlE;AACH;AACJ;AACD;;;;4CACoB;AAChB,gBAAI4F,QAAQ5C,KAAK6C,KAAL,CAAW7C,KAAK8C,MAAL,KAAgB,KAAKjG,WAAhC,CAAZ;AACA,mBAAO,KAAKC,cAAL,CAAoB8F,KAApB,CAAP;AACH;AACD;;;;oCACY1B,YAAYD,YAAY;AAAA;;AAAA;AAE5B,oBAAI8B,eAAe,EAAnB;AACA,oBAAIC,WAAWlC,oBAAQmC,UAAvB;AACA/B,2BAAW5B,OAAX,CAAmB,UAAUmC,KAAV,EAAiB;AAChC,wBAAIA,MAAMf,MAAN,IAAgB3B,wBAAYG,IAAhC,EAAsC;AAClC,6BAAK,IAAIlC,IAAI,CAAb,EAAgBA,KAAKC,sBAArB,EAAiCD,GAAjC,EAAsC;AAClC,gCAAI,KAAKR,KAAL,CAAWiF,MAAM1D,CAAjB,EAAoBf,CAApB,CAAJ,EAA4B;AACxB,oCAAI,KAAKR,KAAL,CAAWiF,MAAM1D,CAAjB,EAAoBf,CAApB,EAAuB0D,MAAvB,IAAiC3B,wBAAY4B,MAAjD,EAAyD;AACrDoC,iDAAa3E,IAAb,CAAkB,KAAK5B,KAAL,CAAWiF,MAAM1D,CAAjB,EAAoBf,CAApB,CAAlB;AACH;AACD,qCAAK0E,SAAL,CAAe1E,CAAf,EAAkByE,MAAM1D,CAAxB,EAA2B,KAA3B,EAAkCkD,UAAlC;AACH;AACJ;AACD,6BAAKiC,UAAL,CAAgB,KAAK3C,OAArB,EAA8B5D,GAAGC,EAAH,CAAM6E,MAAM3D,CAAZ,EAAe2D,MAAM1D,CAArB,CAA9B;AACH,qBAVD,MAWK,IAAI0D,MAAMf,MAAN,IAAgB3B,wBAAYI,MAAhC,EAAwC;AACzC,6BAAK,IAAInC,MAAI,CAAb,EAAgBA,OAAKG,uBAArB,EAAkCH,KAAlC,EAAuC;AACnC,gCAAI,KAAKR,KAAL,CAAWQ,GAAX,EAAcyE,MAAM3D,CAApB,CAAJ,EAA4B;AACxB,oCAAI,KAAKtB,KAAL,CAAWQ,GAAX,EAAcyE,MAAM3D,CAApB,EAAuB4C,MAAvB,IAAiC3B,wBAAY4B,MAAjD,EAAyD;AACrDoC,iDAAa3E,IAAb,CAAkB,KAAK5B,KAAL,CAAWQ,GAAX,EAAcyE,MAAM3D,CAApB,CAAlB;AACH;AACD,qCAAK4D,SAAL,CAAeD,MAAM3D,CAArB,EAAwBd,GAAxB,EAA2B,KAA3B,EAAkCiE,UAAlC;AACH;AACJ;AACD,6BAAKkC,UAAL,CAAgB,KAAK5C,OAArB,EAA8B5D,GAAGC,EAAH,CAAM6E,MAAM3D,CAAZ,EAAe2D,MAAM1D,CAArB,CAA9B;AACH,qBAVI,MAWA,IAAI0D,MAAMf,MAAN,IAAgB3B,wBAAYE,IAAhC,EAAsC;AACvC,4BAAInB,IAAI2D,MAAM3D,CAAd;AACA,4BAAIC,IAAI0D,MAAM1D,CAAd;AACA,6BAAK,IAAIf,MAAI,CAAb,EAAgBA,OAAKG,uBAArB,EAAkCH,KAAlC,EAAuC;AACnC,iCAAK,IAAIE,IAAI,CAAb,EAAgBA,KAAKD,sBAArB,EAAiCC,GAAjC,EAAsC;AAClC,oCAAI6C,QAAQC,KAAKC,GAAL,CAASnC,IAAIZ,CAAb,IAAkB8C,KAAKC,GAAL,CAASlC,IAAIf,GAAb,CAA9B;AACA,oCAAI,KAAKR,KAAL,CAAWQ,GAAX,EAAcE,CAAd,KAAoB6C,SAAS,CAAjC,EAAoC;AAChC,wCAAI,KAAKvD,KAAL,CAAWQ,GAAX,EAAcE,CAAd,EAAiBwD,MAAjB,IAA2B3B,wBAAY4B,MAA3C,EAAmD;AAC/CoC,qDAAa3E,IAAb,CAAkB,KAAK5B,KAAL,CAAWQ,GAAX,EAAcE,CAAd,CAAlB;AACH;AACD,yCAAKwE,SAAL,CAAexE,CAAf,EAAkBF,GAAlB,EAAqB,KAArB,EAA4BiE,UAA5B;AACH;AACJ;AACJ;AACJ,qBAdI,MAeA,IAAIQ,MAAMf,MAAN,IAAgB3B,wBAAYC,IAAhC,EAAsC;AACvC,4BAAIoE,YAAY3B,MAAM/C,IAAtB;AACA,4BAAIsE,WAAWlC,oBAAQuC,eAAvB,EAAwC;AACpCL,uCAAWlC,oBAAQuC,eAAnB;AACH;AACD,4BAAID,aAAarB,sBAAU/C,IAA3B,EAAiC;AAC7BoE,wCAAY,KAAK7F,iBAAL,EAAZ;AACH;AACD,6BAAK,IAAIP,MAAI,CAAb,EAAgBA,OAAKG,uBAArB,EAAkCH,KAAlC,EAAuC;AACnC,iCAAK,IAAIE,KAAI,CAAb,EAAgBA,MAAKD,sBAArB,EAAiCC,IAAjC,EAAsC;AAClC,oCAAI,KAAKV,KAAL,CAAWQ,GAAX,EAAcE,EAAd,KAAoB,KAAKV,KAAL,CAAWQ,GAAX,EAAcE,EAAd,EAAiBwB,IAAjB,IAAyB0E,SAAjD,EAA4D;AACxD,wCAAI,KAAK5G,KAAL,CAAWQ,GAAX,EAAcE,EAAd,EAAiBwD,MAAjB,IAA2B3B,wBAAY4B,MAA3C,EAAmD;AAC/CoC,qDAAa3E,IAAb,CAAkB,KAAK5B,KAAL,CAAWQ,GAAX,EAAcE,EAAd,CAAlB;AACH;AACD,yCAAKwE,SAAL,CAAexE,EAAf,EAAkBF,GAAlB,EAAqB,IAArB,EAA2BiE,UAA3B;AACH;AACJ;AACJ;AACD;AACH;AACJ,iBA1DD;AA2DA,oBAAIC,WAAWxD,MAAX,GAAoB,CAAxB,EAA2B;AACvB,0BAAK6C,OAAL,IAAgByC,QAAhB;AACH;AACD9B,6BAAa6B,YAAb;AAlE4B;;AAChC,mBAAO7B,WAAWxD,MAAX,GAAoB,CAA3B,EAA8B;AAAA;AAkE7B;AACJ;AACD;;;;;;;;;uCAMe4F,UAAU1D,KAAK2D,MAAM;AAChC,iBAAKzD,YAAL,CAAkB1B,IAAlB,CAAuB;AACnBkF,kCADmB;AAEnB1D,wBAFmB;AAGnB4D,wBAAQ,OAHW;AAInBD;AAJmB,aAAvB;AAMH;;;mCAEUD,UAAU1D,KAAK;AACtB,iBAAKE,YAAL,CAAkB1B,IAAlB,CAAuB;AACnBkF,kCADmB;AAEnB1D,wBAFmB;AAGnB4D,wBAAQ;AAHW,aAAvB;AAKH;;;mCAEUF,UAAU1D,KAAK;AACtB,iBAAKE,YAAL,CAAkB1B,IAAlB,CAAuB;AACnBkF,kCADmB;AAEnB1D,wBAFmB;AAGnB4D,wBAAQ;AAHW,aAAvB;AAKH;;;oCAEWF,UAAU1D,KAAK,CAE1B;AADG;;AAEJ;;;;kCACU9B,GAAGC,GAAG0F,WAAWF,MAAM;AAC7B,gBAAI9B,QAAQ,KAAKjF,KAAL,CAAWuB,CAAX,EAAcD,CAAd,CAAZ;AACA,iBAAK0C,kBAAL,CAAwBiB,KAAxB;AACA,gBAAIgC,SAAJ,EAAe;AACXhC,sBAAMiC,OAAN,CAAc,KAAKnD,OAAnB;AACH;;AAED,gBAAIoD,YAAYF,YAAY3C,oBAAQ8C,SAApB,GAAgC,CAAhD;AACAnC,kBAAMoC,KAAN,CAAY,KAAKtD,OAAL,GAAeoD,SAA3B;AACA,iBAAKG,cAAL,CAAoB,KAAKvD,OAAL,GAAeoD,SAAnC,EAA8ChH,GAAGC,EAAH,CAAM6E,MAAM3D,CAAZ,EAAe2D,MAAM1D,CAArB,CAA9C,EAAuEwF,IAAvE;AACA,iBAAK/G,KAAL,CAAWuB,CAAX,EAAcD,CAAd,IAAmB,IAAnB;AACH;;;;;;kBA7agBvB","file":"GameModel.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Model","sourcesContent":["import CellModel from \"./CellModel\";\nimport { CELL_TYPE, CELL_BASENUM, CELL_STATUS, GRID_WIDTH, GRID_HEIGHT, ANITIME } from \"./ConstValue\";\n\nexport default class GameModel {\n    constructor() {\n        this.cells = null;\n        this.cellBgs = null;\n        this.lastPos = cc.v2(-1, -1);\n        this.cellTypeNum = 5;\n        this.cellCreateType = []; // 升成种类只在这个数组里面查找\n    }\n\n    init(cellTypeNum) {\n        this.cells = [];\n        this.setCellTypeNum(cellTypeNum || this.cellTypeNum);\n        for (var i = 1; i <= GRID_WIDTH; i++) {\n            this.cells[i] = [];\n            for (var j = 1; j <= GRID_HEIGHT; j++) {\n                this.cells[i][j] = new CellModel();\n            }\n        }\n\n        for (var i = 1; i <= GRID_WIDTH; i++) {\n            for (var j = 1; j <= GRID_HEIGHT; j++) {\n                let flag = true;\n                while (flag) {\n                    flag = false;\n                    this.cells[i][j].init(this.getRandomCellType());\n                    let result = this.checkPoint(j, i)[0];\n                    if (result.length > 2) {\n                        flag = true;\n                    }\n                    this.cells[i][j].setXY(j, i);\n                    this.cells[i][j].setStartXY(j, i);\n                }\n            }\n        }\n\n    }\n\n    initWithData(data) {\n        // to do\n    }\n\n    checkPoint(x, y) {\n        let checkWithDirection = function (x, y, direction) {\n            let queue = [];\n            let vis = [];\n            vis[x + y * 9] = true;\n            queue.push(cc.v2(x, y));\n            let front = 0;\n            while (front < queue.length) {\n                //let direction = [cc.v2(0, -1), cc.v2(0, 1), cc.v2(1, 0), cc.v2(-1, 0)];\n                let point = queue[front];\n                let cellModel = this.cells[point.y][point.x];\n                front++;\n                if (!cellModel) {\n                    continue;\n                }\n                for (let i = 0; i < direction.length; i++) {\n                    let tmpX = point.x + direction[i].x;\n                    let tmpY = point.y + direction[i].y;\n                    if (tmpX < 1 || tmpX > 9\n                        || tmpY < 1 || tmpY > 9\n                        || vis[tmpX + tmpY * 9]\n                        || !this.cells[tmpY][tmpX]) {\n                        continue;\n                    }\n                    if (cellModel.type == this.cells[tmpY][tmpX].type) {\n                        vis[tmpX + tmpY * 9] = true;\n                        queue.push(cc.v2(tmpX, tmpY));\n                    }\n                }\n            }\n            return queue;\n        }\n        let rowResult = checkWithDirection.call(this, x, y, [cc.v2(1, 0), cc.v2(-1, 0)]);\n        let colResult = checkWithDirection.call(this, x, y, [cc.v2(0, -1), cc.v2(0, 1)]);\n        let result = [];\n        let newCellStatus = \"\";\n        if (rowResult.length >= 5 || colResult.length >= 5) {\n            newCellStatus = CELL_STATUS.BIRD;\n        }\n        else if (rowResult.length >= 3 && colResult.length >= 3) {\n            newCellStatus = CELL_STATUS.WRAP;\n        }\n        else if (rowResult.length >= 4) {\n            newCellStatus = CELL_STATUS.LINE;\n        }\n        else if (colResult.length >= 4) {\n            newCellStatus = CELL_STATUS.COLUMN;\n        }\n        if (rowResult.length >= 3) {\n            result = rowResult;\n        }\n        if (colResult.length >= 3) {\n            let tmp = result.concat();\n            colResult.forEach(function (newEle) {\n                let flag = false;\n                tmp.forEach(function (oldEle) {\n                    if (newEle.x == oldEle.x && newEle.y == oldEle.y) {\n                        flag = true;\n                    }\n                }, this);\n                if (!flag) {\n                    result.push(newEle);\n                }\n            }, this);\n        }\n        return [result, newCellStatus, this.cells[y][x].type];\n    }\n\n    printInfo() {\n        for (var i = 1; i <= 9; i++) {\n            var printStr = \"\";\n            for (var j = 1; j <= 9; j++) {\n                printStr += this.cells[i][j].type + \" \";\n            }\n            console.log(printStr);\n        }\n    }\n\n    getCells() {\n        return this.cells;\n    }\n    // controller调用的主要入口\n    // 点击某个格子\n    selectCell(pos) {\n        this.changeModels = [];// 发生改变的model，将作为返回值，给view播动作\n        this.effectsQueue = []; // 动物消失，爆炸等特效\n        var lastPos = this.lastPos;\n        var delta = Math.abs(pos.x - lastPos.x) + Math.abs(pos.y - lastPos.y);\n        if (delta != 1) { //非相邻格子， 直接返回\n            this.lastPos = pos;\n            return [[], []];\n        }\n        let curClickCell = this.cells[pos.y][pos.x]; //当前点击的格子\n        let lastClickCell = this.cells[lastPos.y][lastPos.x]; // 上一次点击的格式\n        this.exchangeCell(lastPos, pos);\n        var result1 = this.checkPoint(pos.x, pos.y)[0];\n        var result2 = this.checkPoint(lastPos.x, lastPos.y)[0];\n        this.curTime = 0; // 动画播放的当前时间\n        this.pushToChangeModels(curClickCell);\n        this.pushToChangeModels(lastClickCell);\n        let isCanBomb = (curClickCell.status != CELL_STATUS.COMMON && // 判断两个是否是特殊的动物\n            lastClickCell.status != CELL_STATUS.COMMON) ||\n            curClickCell.status == CELL_STATUS.BIRD ||\n            lastClickCell.status == CELL_STATUS.BIRD;\n        if (result1.length < 3 && result2.length < 3 && !isCanBomb) {//不会发生消除的情况\n            this.exchangeCell(lastPos, pos);\n            curClickCell.moveToAndBack(lastPos);\n            lastClickCell.moveToAndBack(pos);\n            this.lastPos = cc.v2(-1, -1);\n            return [this.changeModels];\n        }\n        else {\n            this.lastPos = cc.v2(-1, -1);\n            curClickCell.moveTo(lastPos, this.curTime);\n            lastClickCell.moveTo(pos, this.curTime);\n            var checkPoint = [pos, lastPos];\n            this.curTime += ANITIME.TOUCH_MOVE;\n            this.processCrush(checkPoint);\n            return [this.changeModels, this.effectsQueue];\n        }\n    }\n    // 消除\n    processCrush(checkPoint) {\n        let cycleCount = 0;\n        while (checkPoint.length > 0) {\n            let bombModels = [];\n            if (cycleCount == 0 && checkPoint.length == 2) { //特殊消除\n                let pos1 = checkPoint[0];\n                let pos2 = checkPoint[1];\n                let model1 = this.cells[pos1.y][pos1.x];\n                let model2 = this.cells[pos2.y][pos2.x];\n                if (model1.status == CELL_STATUS.BIRD || model2.status == CELL_STATUS.BIRD) {\n                    let bombModel = null;\n                    if (model1.status == CELL_STATUS.BIRD) {\n                        model1.type = model2.type;\n                        bombModels.push(model1);\n                    }\n                    else {\n                        model2.type = model1.type;\n                        bombModels.push(model2);\n                    }\n\n                }\n            }\n            for (var i in checkPoint) {\n                var pos = checkPoint[i];\n                if (!this.cells[pos.y][pos.x]) {\n                    continue;\n                }\n                var [result, newCellStatus, newCellType] = this.checkPoint(pos.x, pos.y);\n\n                if (result.length < 3) {\n                    continue;\n                }\n                for (var j in result) {\n                    var model = this.cells[result[j].y][result[j].x];\n                    this.crushCell(result[j].x, result[j].y, false, cycleCount);\n                    if (model.status != CELL_STATUS.COMMON) {\n                        bombModels.push(model);\n                    }\n                }\n                this.createNewCell(pos, newCellStatus, newCellType);\n\n            }\n            this.processBomb(bombModels, cycleCount);\n            this.curTime += ANITIME.DIE;\n            checkPoint = this.down();\n            cycleCount++;\n        }\n    }\n\n    //生成新cell\n    createNewCell(pos, status, type) {\n        if (status == \"\") {\n            return;\n        }\n        if (status == CELL_STATUS.BIRD) {\n            type = CELL_TYPE.BIRD\n        }\n        let model = new CellModel();\n        this.cells[pos.y][pos.x] = model\n        model.init(type);\n        model.setStartXY(pos.x, pos.y);\n        model.setXY(pos.x, pos.y);\n        model.setStatus(status);\n        model.setVisible(0, false);\n        model.setVisible(this.curTime, true);\n        this.changeModels.push(model);\n    }\n    // 下落\n    down() {\n        let newCheckPoint = [];\n        for (var i = 1; i <= GRID_WIDTH; i++) {\n            for (var j = 1; j <= GRID_HEIGHT; j++) {\n                if (this.cells[i][j] == null) {\n                    var curRow = i;\n                    for (var k = curRow; k <= GRID_HEIGHT; k++) {\n                        if (this.cells[k][j]) {\n                            this.pushToChangeModels(this.cells[k][j]);\n                            newCheckPoint.push(this.cells[k][j]);\n                            this.cells[curRow][j] = this.cells[k][j];\n                            this.cells[k][j] = null;\n                            this.cells[curRow][j].setXY(j, curRow);\n                            this.cells[curRow][j].moveTo(cc.v2(j, curRow), this.curTime);\n                            curRow++;\n                        }\n                    }\n                    var count = 1;\n                    for (var k = curRow; k <= GRID_HEIGHT; k++) {\n                        this.cells[k][j] = new CellModel();\n                        this.cells[k][j].init(this.getRandomCellType());\n                        this.cells[k][j].setStartXY(j, count + GRID_HEIGHT);\n                        this.cells[k][j].setXY(j, count + GRID_HEIGHT);\n                        this.cells[k][j].moveTo(cc.v2(j, k), this.curTime);\n                        count++;\n                        this.changeModels.push(this.cells[k][j]);\n                        newCheckPoint.push(this.cells[k][j]);\n                    }\n\n                }\n            }\n        }\n        this.curTime += ANITIME.TOUCH_MOVE + 0.3\n        return newCheckPoint;\n    }\n\n    pushToChangeModels(model) {\n        if (this.changeModels.indexOf(model) != -1) {\n            return;\n        }\n        this.changeModels.push(model);\n    }\n\n    cleanCmd() {\n        for (var i = 1; i <= GRID_WIDTH; i++) {\n            for (var j = 1; j <= GRID_HEIGHT; j++) {\n                if (this.cells[i][j]) {\n                    this.cells[i][j].cmd = [];\n                }\n            }\n        }\n    }\n\n    exchangeCell(pos1, pos2) {\n        var tmpModel = this.cells[pos1.y][pos1.x];\n        this.cells[pos1.y][pos1.x] = this.cells[pos2.y][pos2.x];\n        this.cells[pos1.y][pos1.x].x = pos1.x;\n        this.cells[pos1.y][pos1.x].y = pos1.y;\n        this.cells[pos2.y][pos2.x] = tmpModel;\n        this.cells[pos2.y][pos2.x].x = pos2.x;\n        this.cells[pos2.y][pos2.x].y = pos2.y;\n    }\n    // 设置种类\n    // Todo 改成乱序算法\n    setCellTypeNum(num) {\n        console.log(\"num = \", num);\n        this.cellTypeNum = num;\n        this.cellCreateType = [];\n        let createTypeList = this.cellCreateType;\n        for (let i = 1; i <= CELL_BASENUM; i++) {\n            createTypeList.push(i);\n        }\n        for (let i = 0; i < createTypeList.length; i++) {\n            let index = Math.floor(Math.random() * (CELL_BASENUM - i)) + i;\n            createTypeList[i], createTypeList[index] = createTypeList[index], createTypeList[i]\n        }\n    }\n    // 随要生成一个类型\n    getRandomCellType() {\n        var index = Math.floor(Math.random() * this.cellTypeNum);\n        return this.cellCreateType[index];\n    }\n    // TODO bombModels去重\n    processBomb(bombModels, cycleCount) {\n        while (bombModels.length > 0) {\n            let newBombModel = [];\n            let bombTime = ANITIME.BOMB_DELAY;\n            bombModels.forEach(function (model) {\n                if (model.status == CELL_STATUS.LINE) {\n                    for (let i = 1; i <= GRID_WIDTH; i++) {\n                        if (this.cells[model.y][i]) {\n                            if (this.cells[model.y][i].status != CELL_STATUS.COMMON) {\n                                newBombModel.push(this.cells[model.y][i]);\n                            }\n                            this.crushCell(i, model.y, false, cycleCount);\n                        }\n                    }\n                    this.addRowBomb(this.curTime, cc.v2(model.x, model.y));\n                }\n                else if (model.status == CELL_STATUS.COLUMN) {\n                    for (let i = 1; i <= GRID_HEIGHT; i++) {\n                        if (this.cells[i][model.x]) {\n                            if (this.cells[i][model.x].status != CELL_STATUS.COMMON) {\n                                newBombModel.push(this.cells[i][model.x]);\n                            }\n                            this.crushCell(model.x, i, false, cycleCount);\n                        }\n                    }\n                    this.addColBomb(this.curTime, cc.v2(model.x, model.y));\n                }\n                else if (model.status == CELL_STATUS.WRAP) {\n                    let x = model.x;\n                    let y = model.y;\n                    for (let i = 1; i <= GRID_HEIGHT; i++) {\n                        for (let j = 1; j <= GRID_WIDTH; j++) {\n                            let delta = Math.abs(x - j) + Math.abs(y - i);\n                            if (this.cells[i][j] && delta <= 2) {\n                                if (this.cells[i][j].status != CELL_STATUS.COMMON) {\n                                    newBombModel.push(this.cells[i][j]);\n                                }\n                                this.crushCell(j, i, false, cycleCount);\n                            }\n                        }\n                    }\n                }\n                else if (model.status == CELL_STATUS.BIRD) {\n                    let crushType = model.type\n                    if (bombTime < ANITIME.BOMB_BIRD_DELAY) {\n                        bombTime = ANITIME.BOMB_BIRD_DELAY;\n                    }\n                    if (crushType == CELL_TYPE.BIRD) {\n                        crushType = this.getRandomCellType();\n                    }\n                    for (let i = 1; i <= GRID_HEIGHT; i++) {\n                        for (let j = 1; j <= GRID_WIDTH; j++) {\n                            if (this.cells[i][j] && this.cells[i][j].type == crushType) {\n                                if (this.cells[i][j].status != CELL_STATUS.COMMON) {\n                                    newBombModel.push(this.cells[i][j]);\n                                }\n                                this.crushCell(j, i, true, cycleCount);\n                            }\n                        }\n                    }\n                    //this.crushCell(model.x, model.y);\n                }\n            }, this);\n            if (bombModels.length > 0) {\n                this.curTime += bombTime;\n            }\n            bombModels = newBombModel;\n        }\n    }\n    /**\n     * \n     * @param {开始播放的时间} playTime \n     * @param {*cell位置} pos \n     * @param {*第几次消除，用于播放音效} step \n     */\n    addCrushEffect(playTime, pos, step) {\n        this.effectsQueue.push({\n            playTime,\n            pos,\n            action: \"crush\",\n            step\n        });\n    }\n\n    addRowBomb(playTime, pos) {\n        this.effectsQueue.push({\n            playTime,\n            pos,\n            action: \"rowBomb\"\n        });\n    }\n\n    addColBomb(playTime, pos) {\n        this.effectsQueue.push({\n            playTime,\n            pos,\n            action: \"colBomb\"\n        });\n    }\n\n    addWrapBomb(playTime, pos) {\n        // TODO\n    }\n    // cell消除逻辑\n    crushCell(x, y, needShake, step) {\n        let model = this.cells[y][x];\n        this.pushToChangeModels(model);\n        if (needShake) {\n            model.toShake(this.curTime)\n        }\n\n        let shakeTime = needShake ? ANITIME.DIE_SHAKE : 0;\n        model.toDie(this.curTime + shakeTime);\n        this.addCrushEffect(this.curTime + shakeTime, cc.v2(model.x, model.y), step);\n        this.cells[y][x] = null;\n    }\n\n}\n\n"]}