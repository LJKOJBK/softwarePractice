{"version":3,"sources":["EffectLayer.js"],"names":["cc","Class","extends","Component","properties","bombWhite","default","type","Prefab","crushEffect","audioUtils","AudioUtils","onLoad","playEffects","effectQueue","length","soundMap","forEach","cmd","delayTime","playTime","callFunc","instantEffect","animation","action","instantiate","getComponent","Animation","play","playEliminate","step","x","CELL_WIDTH","pos","y","parent","node","on","destroy","runAction","sequence"],"mappings":";;;;;;AAAA;;AAEA;;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,mBAAU;AACNC,qBAAS,IADH;AAENC,kBAAMP,GAAGQ;AAFH,SAXF;AAeRC,qBAAY;AACRH,qBAAS,IADD;AAERC,kBAAMP,GAAGQ;AAFD,SAfJ;AAmBRE,oBAAW;AACPH,kBAAMI,oBADC;AAEPL,qBAAS;AAFF;AAnBH,KAHP;;AA4BL;AACAM,YAAQ,kBAAY,CAEnB,CA/BI;AAgCLC,iBAAa,qBAASC,WAAT,EAAqB;AAC9B,YAAG,CAACA,WAAD,IAAgBA,YAAYC,MAAZ,IAAsB,CAAzC,EAA2C;AACvC;AACH;AACD,YAAIC,WAAW,EAAf,CAJ8B,CAIX;AACnBF,oBAAYG,OAAZ,CAAoB,UAASC,GAAT,EAAa;AAC7B,gBAAIC,YAAYnB,GAAGmB,SAAH,CAAaD,IAAIE,QAAjB,CAAhB;AACA,gBAAIC,WAAWrB,GAAGqB,QAAH,CAAY,YAAU;AACjC,oBAAIC,gBAAgB,IAApB;AACA,oBAAIC,YAAY,IAAhB;AACA,oBAAGL,IAAIM,MAAJ,IAAc,OAAjB,EAAyB;AACrBF,oCAAgBtB,GAAGyB,WAAH,CAAe,KAAKhB,WAApB,CAAhB;AACAc,gCAAaD,cAAcI,YAAd,CAA2B1B,GAAG2B,SAA9B,CAAb;AACAJ,8BAAUK,IAAV,CAAe,QAAf;AACA,qBAACZ,SAAS,UAAUE,IAAIE,QAAvB,CAAD,IAAqC,KAAKV,UAAL,CAAgBmB,aAAhB,CAA8BX,IAAIY,IAAlC,CAArC;AACAd,6BAAS,UAAUE,IAAIE,QAAvB,IAAmC,IAAnC;AACH,iBAND,MAOK,IAAGF,IAAIM,MAAJ,IAAc,SAAjB,EAA2B;AAC5BF,oCAAgBtB,GAAGyB,WAAH,CAAe,KAAKpB,SAApB,CAAhB;AACAkB,gCAAaD,cAAcI,YAAd,CAA2B1B,GAAG2B,SAA9B,CAAb;AACAJ,8BAAUK,IAAV,CAAe,aAAf;AACH,iBAJI,MAKA,IAAGV,IAAIM,MAAJ,IAAc,SAAjB,EAA2B;AAC5BF,oCAAgBtB,GAAGyB,WAAH,CAAe,KAAKpB,SAApB,CAAhB;AACAkB,gCAAaD,cAAcI,YAAd,CAA2B1B,GAAG2B,SAA9B,CAAb;AACAJ,8BAAUK,IAAV,CAAe,YAAf;AACH;;AAEDN,8BAAcS,CAAd,GAAkBC,0BAAcd,IAAIe,GAAJ,CAAQF,CAAR,GAAY,GAA1B,CAAlB;AACAT,8BAAcY,CAAd,GAAkBF,0BAAcd,IAAIe,GAAJ,CAAQC,CAAR,GAAY,GAA1B,CAAlB;AACAZ,8BAAca,MAAd,GAAuB,KAAKC,IAA5B;AACAb,0BAAUc,EAAV,CAAa,UAAb,EAAwB,YAAU;AAC9Bf,kCAAcgB,OAAd;AACH,iBAFD,EAEE,IAFF;AAIH,aA5Bc,EA4Bb,IA5Ba,CAAf;AA6BA,iBAAKF,IAAL,CAAUG,SAAV,CAAoBvC,GAAGwC,QAAH,CAAYrB,SAAZ,EAAuBE,QAAvB,CAApB;AACH,SAhCD,EAgCE,IAhCF;AAiCH;;AAED;AACA;;AAEA;AA3EK,CAAT","file":"EffectLayer.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\View","sourcesContent":["import {CELL_WIDTH} from '../Model/ConstValue';\n\nimport AudioUtils from \"../Utils/AudioUtils\";\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //    default: null,      // The default value will be used only when the component attaching\n        //                           to a node for the first time\n        //    url: cc.Texture2D,  // optional, default is typeof default\n        //    serializable: true, // optional, default is true\n        //    visible: true,      // optional, default is true\n        //    displayName: 'Foo', // optional\n        //    readonly: false,    // optional, default is false\n        // },\n        // ...\n        bombWhite:{\n            default: null,\n            type: cc.Prefab\n        },\n        crushEffect:{\n            default: null,\n            type: cc.Prefab\n        },\n        audioUtils:{\n            type: AudioUtils,\n            default: null\n        }\n    },\n\n    // use this for initialization\n    onLoad: function () {\n\n    },\n    playEffects: function(effectQueue){\n        if(!effectQueue || effectQueue.length <= 0){\n            return ;\n        }\n        let soundMap = {}; //某一时刻，某一种声音是否播放过的标记，防止重复播放\n        effectQueue.forEach(function(cmd){\n            let delayTime = cc.delayTime(cmd.playTime);\n            let callFunc = cc.callFunc(function(){\n                let instantEffect = null;\n                let animation = null;\n                if(cmd.action == \"crush\"){\n                    instantEffect = cc.instantiate(this.crushEffect);\n                    animation  = instantEffect.getComponent(cc.Animation);\n                    animation.play(\"effect\");\n                    !soundMap[\"crush\" + cmd.playTime] && this.audioUtils.playEliminate(cmd.step);\n                    soundMap[\"crush\" + cmd.playTime] = true;\n                }\n                else if(cmd.action == \"rowBomb\"){\n                    instantEffect = cc.instantiate(this.bombWhite);\n                    animation  = instantEffect.getComponent(cc.Animation);\n                    animation.play(\"effect_line\");\n                }\n                else if(cmd.action == \"colBomb\"){\n                    instantEffect = cc.instantiate(this.bombWhite);\n                    animation  = instantEffect.getComponent(cc.Animation);\n                    animation.play(\"effect_col\");\n                }\n\n                instantEffect.x = CELL_WIDTH * (cmd.pos.x - 0.5);\n                instantEffect.y = CELL_WIDTH * (cmd.pos.y - 0.5);\n                instantEffect.parent = this.node;\n                animation.on(\"finished\",function(){\n                    instantEffect.destroy();\n                },this);\n               \n            },this);\n            this.node.runAction(cc.sequence(delayTime, callFunc));\n        },this);\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n});\n"]}